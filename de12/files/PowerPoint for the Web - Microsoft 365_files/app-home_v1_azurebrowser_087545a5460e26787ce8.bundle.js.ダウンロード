/*! For license information please see app-home_v1_azurebrowser_087545a5460e26787ce8.bundle.js.LICENSE.txt */
"use strict";(self["app-home_v1_jsonp"]=self["app-home_v1_jsonp"]||[]).push([[64392],{6223:(e,t,r)=>{r.d(t,{K:()=>i});var o=r(48405),n=r(47381);const i={initialize:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),acquireTokenPopup:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),acquireTokenRedirect:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),acquireTokenSilent:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),acquireTokenByCode:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),loginPopup:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),loginRedirect:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),logout:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),logoutRedirect:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),logoutPopup:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),ssoSilent:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw(0,o.jz)(n.stubbedPublicClientApplicationCalled)},getLogger:()=>{throw(0,o.jz)(n.stubbedPublicClientApplicationCalled)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw(0,o.jz)(n.stubbedPublicClientApplicationCalled)},hydrateCache:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled)),clearCache:()=>Promise.reject((0,o.jz)(n.stubbedPublicClientApplicationCalled))}},81136:(e,t,r)=>{r.d(t,{Ji:()=>l,q8:()=>h,vq:()=>c});var o=r(12096),n=r(42582),i=r(22224),a=r(30181),s=r(92775);class c{static async createPublicClientApplication(e){const t=await(0,o.K)(e);return new c(e,t)}constructor(e,t){this.controller=t||new n.i(new i.A(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}async function l(e){const t=new s.R(e);if(await t.initialize(),t.isAvailable()){const r=new a.l(t);return new c(e,r)}return h(e)}async function h(e){const t=new c(e);return await t.initialize(),t}},26279:(e,t,r)=>{function o(e,t,r,o){return e.verbose("getAllAccounts called"),r?t.getAllAccounts(o):[]}function n(e,t,r){if(t.trace("getAccount called"),0===Object.keys(e).length)return t.warning("getAccount: No accountFilter provided"),null;const o=r.getAccountInfoFilteredBy(e);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}function i(e,t,r){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;const o=r.getAccountInfoFilteredBy({username:e});return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}function a(e,t,r){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=r.getAccountInfoFilteredBy({homeAccountId:e});return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function s(e,t,r){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;const o=r.getAccountInfoFilteredBy({localAccountId:e});return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function c(e,t){t.setActiveAccount(e)}function l(e){return e.getActiveAccount()}r.d(t,{I$:()=>c,Is:()=>o,P6:()=>s,PX:()=>a,hN:()=>i,sU:()=>n,yq:()=>l})},25568:(e,t,r)=>{r.d(t,{E:()=>k,c:()=>b});var o=r(47468),n=r(18087),i=r(14476),a=r(99611),s=r(44774),c=r(28952),l=r(65925),h=r(36106),d=r(91755),u=r(17016),g=r(24595),p=r(27631),m=r(78822),C=r(46093),v=r(51681),f=r(37738),y=r(83359),w=r(19973),I=r(37786),T=r(10678),A=r(70413);class b extends o.G{constructor(e,t,r,o,n,i){super(e,r,o,n),this.COOKIE_LIFE_MULTIPLIER=864e5,this.cacheConfig=t,this.logger=o,this.internalStorage=new y.X,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=i}setupBrowserStorage(e){switch(e){case v.Al.LocalStorage:case v.Al.SessionStorage:try{return new f.s(e)}catch(e){this.logger.verbose(e);break}}return this.cacheConfig.cacheLocation=v.Al.MemoryStorage,new y.X}setupTemporaryCacheStorage(e,t){switch(t){case v.Al.LocalStorage:case v.Al.SessionStorage:try{return new f.s(e||v.Al.SessionStorage)}catch(e){return this.logger.verbose(e),this.internalStorage}case v.Al.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${n.YM.CACHE_PREFIX}.${n.Gd.ID_TOKEN}`,t=`${n.YM.CACHE_PREFIX}.${n.Gd.CLIENT_INFO}`,r=`${n.YM.CACHE_PREFIX}.${n.Gd.ERROR}`,o=`${n.YM.CACHE_PREFIX}.${n.Gd.ERROR_DESC}`,i=[this.browserStorage.getItem(e),this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(o)];[n.Gd.ID_TOKEN,n.Gd.CLIENT_INFO,n.Gd.ERROR,n.Gd.ERROR_DESC].forEach(((e,t)=>{const r=i[t];r&&this.setTemporaryCache(e,r,!0)}))}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(v.dh.ACCOUNT_KEYS),t=this.getItem(`${v.dh.TOKEN_KEYS}.${this.clientId}`);e&&t?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach((e=>{if(this.isCredentialKey(e)){const t=this.getItem(e);if(t){const r=this.validateAndParseJson(t);if(r&&r.hasOwnProperty("credentialType"))switch(r.credentialType){case n.aG.ID_TOKEN:if(i.Kx(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${e} found, saving key to token key map`);const t=r,o=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(o,n.aG.ID_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${e}`);break;case n.aG.ACCESS_TOKEN:case n.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(i.dj(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${e} found, saving key to token key map`);const t=r,o=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(o,n.aG.ACCESS_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${e}`);break;case n.aG.REFRESH_TOKEN:if(i.WB(r)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${e} found, saving key to token key map`);const t=r,o=this.updateCredentialCacheKey(e,t);return void this.addTokenKey(o,n.aG.REFRESH_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${e}`)}}}if(this.isAccountKey(e)){const t=this.getItem(e);if(t){const r=this.validateAndParseJson(t);r&&a.d.isAccountEntity(r)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${e} found, saving key to account key map`),this.addAccountKeyToMap(e))}}}))}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const r=this.validateAndParseJson(t);return r&&a.d.isAccountEntity(r)?o.G.toObject(new a.d,r):(this.removeAccountKeyFromMap(e),null)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(v.dh.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem(v.dh.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(v.dh.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,n.aG.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,n.aG.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,n.aG.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${v.dh.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const r=this.getTokenKeys();switch(t){case n.aG.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case n.aG.ACCESS_TOKEN:-1===r.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case n.aG.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,s.SB)(c.unexpectedCredentialType)}this.setItem(`${v.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const r=this.getTokenKeys();switch(t){case n.aG.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const o=r.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case n.aG.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const i=r.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case n.aG.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const a=r.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,s.SB)(c.unexpectedCredentialType)}this.setItem(`${v.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.ID_TOKEN),null;const r=this.validateAndParseJson(t);return r&&i.Kx(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.ID_TOKEN),null)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=i.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,n.aG.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.ACCESS_TOKEN),null;const r=this.validateAndParseJson(t);return r&&i.dj(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.ACCESS_TOKEN),null)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=i.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,n.aG.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.REFRESH_TOKEN),null;const r=this.validateAndParseJson(t);return r&&i.WB(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,n.aG.REFRESH_TOKEN),null)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=i.og(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,n.aG.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&i.ki(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=i.JP(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&i.ur(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&i.ey(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter((e=>this.isAuthorityMetadata(e)))}setWrapperMetadata(e,t){this.internalStorage.setItem(v.H3.WRAPPER_SKU,e),this.internalStorage.setItem(v.H3.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(v.H3.WRAPPER_SKU)||n.YM.EMPTY_STRING,this.internalStorage.getItem(v.H3.WRAPPER_VER)||n.YM.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(n.Gd.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const e=this.generateCacheKey(n.Gd.ACTIVE_ACCOUNT),t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const r=this.getAccountInfoFilteredBy({localAccountId:t});return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(r),r):null}const r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(n.Gd.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(n.Gd.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(o)),this.browserStorage.setItem(r,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&i.r1(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.getItemCookie(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===v.Al.LocalStorage){const e=this.browserStorage.getItem(r);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){const o=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(o,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach((e=>{-1===e.indexOf(n.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)})),this.browserStorage.getKeys().forEach((e=>{-1===e.indexOf(n.YM.CACHE_PREFIX)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)})),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(l.MX.ClearTokensAndKeysWithClaims,t);const r=this.getTokenKeys(),o=[];r.accessToken.forEach((e=>{const t=this.getAccessTokenCredential(e);t?.requestedClaimsHash&&e.includes(t.requestedClaimsHash.toLowerCase())&&o.push(this.removeAccessToken(e))})),await Promise.all(o),o.length>0&&this.logger.warning(`${o.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,r){let o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;r&&(o+=`expires=${this.getCookieExpirationTime(r)};`),this.cacheConfig.secureCookies&&(o+="Secure;"),document.cookie=o}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){let o=r[e];for(;" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return n.YM.EMPTY_STRING}clearMsalCookies(){const e=`${n.YM.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach((t=>{for(;" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(e)){const e=t.split("=")[0];this.clearItemCookie(e)}}))}clearItemCookie(e){this.setItemCookie(e,n.YM.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):h.$.startsWith(e,n.YM.CACHE_PREFIX)||h.$.startsWith(e,n.Gd.ADAL_ID_TOKEN)?e:`${n.YM.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=d.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${v._p.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=d.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${v._p.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=d.W.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${v._p.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;const o=this.generateAuthorityKey(r);return this.getTemporaryCache(o)}updateCacheEntries(e,t,r,o,n){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,r,!1),n){const e={credential:n.homeAccountId,type:u.X.HOME_ACCOUNT_ID};this.setTemporaryCache(v._p.CCS_CREDENTIAL,JSON.stringify(e),!0)}else if(o){const e={credential:o,type:u.X.UPN};this.setTemporaryCache(v._p.CCS_CREDENTIAL,JSON.stringify(e),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach((t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)})),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(v._p.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(v._p.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(v._p.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(v._p.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(v._p.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(v._p.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||n.YM.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach((t=>{if(-1===t.indexOf(v._p.REQUEST_STATE))return;const r=this.temporaryCacheStorage.getItem(t);if(!r)return;const o=(0,w.A)(this.cryptoImpl,r);o&&o.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))})),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=(0,T.KA)(JSON.stringify(e));this.setTemporaryCache(v._p.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(v._p.REQUEST_PARAMS,!0);if(!t)throw(0,C.bD)(A.noTokenRequestCacheError);let r;try{r=JSON.parse((0,I.u)(t))}catch(e){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${e}`),(0,C.bD)(A.unableToParseTokenRequestCacheError)}if(this.removeTemporaryItem(this.generateCacheKey(v._p.REQUEST_PARAMS)),!r.authority){const t=this.generateAuthorityKey(e),o=this.getTemporaryCache(t);if(!o)throw(0,C.bD)(A.noCachedAuthorityError);r.authority=o}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(v._p.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;return this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${n.YM.CACHE_PREFIX}.${v._p.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${n.YM.CACHE_PREFIX}.${v._p.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw(0,C.bD)(A.interactionInProgress);this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(n.Gd.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(n.Gd.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(n.Gd.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(n.Gd.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const r=t||e;if(r){const e=g.My(r,I.u);if(e.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),e.preferred_username;if(e.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),e.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const r=i.og(t);if(e!==r){const o=this.getItem(e);if(o)return this.browserStorage.removeItem(e),this.setItem(r,o),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){const r=i.c_(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let o;t.claims&&(o=await this.cryptoImpl.hashString(t.claims));const n={idToken:r,accessToken:i.Np(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,I.u,void 0,e.tokenType,void 0,t.sshKid,t.claims,o)};return this.saveCacheRecord(n)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(e){if(e instanceof p.xA&&this.performanceClient&&r)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},r)}catch(e){}throw e}}}const k=(e,t)=>{const r={cacheLocation:v.Al.MemoryStorage,temporaryCacheLocation:v.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new b(e,r,m.j,t)}},37738:(e,t,r)=>{r.d(t,{s:()=>a});var o=r(48405),n=r(51681),i=r(47381);class a{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==n.Al.LocalStorage&&e!==n.Al.SessionStorage||!window[e])throw(0,o.jz)(i.storageNotSupported)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}},83359:(e,t,r)=>{r.d(t,{X:()=>o});class o{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach(((t,r)=>{e.push(r)})),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}},8297:(e,t,r)=>{r.d(t,{YH:()=>f,tD:()=>I});var o=r(18087),n=r(5917),i=r(92731),a=r(78705),s=r(60224),c=r(26494),l=r(89266),h=r(60826),d=r(94348),u=r(51681),g=r(8466),p=r(46093),m=r(70413);class C{async sendGetRequestAsync(e,t){let r;try{r=await fetch(e,{method:u.CC.GET,headers:this.getFetchHeaders(t)})}catch(e){throw window.navigator.onLine?(0,p.bD)(m.getRequestFailed):(0,p.bD)(m.noNetworkConnectivity)}try{return{headers:this.getHeaderDict(r.headers),body:await r.json(),status:r.status}}catch(e){throw(0,p.bD)(m.failedToParseResponse)}}async sendPostRequestAsync(e,t){const r=t&&t.body||o.YM.EMPTY_STRING;let n;try{n=await fetch(e,{method:u.CC.POST,headers:this.getFetchHeaders(t),body:r})}catch(e){throw window.navigator.onLine?(0,p.bD)(m.postRequestFailed):(0,p.bD)(m.noNetworkConnectivity)}try{return{headers:this.getHeaderDict(n.headers),body:await n.json(),status:n.status}}catch(e){throw(0,p.bD)(m.failedToParseResponse)}}getFetchHeaders(e){const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.keys(r).forEach((e=>{t.append(e,r[e])})),t}getHeaderDict(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),t}}const v=6e4,f=1e4,y=3e4,w=2e3;function I({auth:e,cache:t,system:r,telemetry:p},m){const I={clientId:o.YM.EMPTY_STRING,authority:`${o.YM.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:o.YM.EMPTY_STRING,authorityMetadata:o.YM.EMPTY_STRING,redirectUri:o.YM.EMPTY_STRING,postLogoutRedirectUri:o.YM.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:n.e.AAD,OIDCOptions:{serverResponseType:o.zL.FRAGMENT,defaultScopes:[o.YM.OPENID_SCOPE,o.YM.PROFILE_SCOPE,o.YM.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:i._.None,tenant:o.YM.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},T={cacheLocation:u.Al.SessionStorage,temporaryCacheLocation:u.Al.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!t||t.cacheLocation!==u.Al.LocalStorage),claimsBasedCachingEnabled:!1},A={loggerCallback:()=>{},logLevel:a.$.Info,piiLoggingEnabled:!1},b={...{...s.J1,loggerOptions:A,networkClient:m?new C:c.A,navigationClient:new g.c,loadFrameTimeout:0,windowHashTimeout:r?.loadFrameTimeout||v,iframeHashTimeout:r?.loadFrameTimeout||f,navigateFrameWait:0,redirectNavigationTimeout:y,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||w,pollIntervalMilliseconds:u.Q1.DEFAULT_POLL_INTERVAL_MS},...r,loggerOptions:r?.loggerOptions||A},k={application:{appName:o.YM.EMPTY_STRING,appVersion:o.YM.EMPTY_STRING},client:new l.a};if(e?.protocolMode!==n.e.OIDC&&e?.OIDCOptions&&new a.V(b.loggerOptions).warning(JSON.stringify((0,h.aD)(d.cannotSetOIDCOptions))),e?.protocolMode&&e.protocolMode!==n.e.AAD&&b?.allowNativeBroker)throw(0,h.aD)(d.cannotAllowNativeBroker);return{auth:{...I,...e,OIDCOptions:{...I.OIDCOptions,...e?.OIDCOptions}},cache:{...T,...t},system:b,telemetry:{...k,...p}}}},12096:(e,t,r)=>{r.d(t,{K:()=>s,d:()=>c});var o=r(92775),n=r(22224),i=r(42582),a=r(30181);async function s(e,t){const r=new n.A(e);return await r.initialize(),i.i.createController(r,t)}async function c(e){const t=new n.A(e),r=new o.R(e),s=[t.initialize(),r.initialize()];return await Promise.all(s),r.isAvailable()&&e.auth.supportsNestedAppAuth?a.l.createController(r):t.isAvailable()?i.i.createController(t):null}},30181:(e,t,r)=>{r.d(t,{l:()=>P});var o=r(78822),n=r(21113),i=r(65925),a=r(23202),s=r(18087),c=r(99611),l=r(51681),h=r(56165),d=r(81857),u=r(36106),g=r(44774),p=r(28952),m=r(24595),C=r(89451),v=r(59744),f=r(48686),y=r(32041),w=r(5305);class I{constructor(e,t,r,o){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=o}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const r=(new d.W).addClientCapabilitiesToClaims(e.claims,this.clientCapabilities),o=e.scopes||s.aZ;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:o.join(" "),correlationId:void 0!==e.correlationId?e.correlationId:this.crypto.createNewGuid(),claims:u.$.isEmptyObj(r)?void 0:r,state:e.state,authenticationScheme:e.authenticationScheme||s.IO.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw(0,g.SB)(p.nullOrEmptyToken);const o=new Date(1e3*(r+(t.token.expires_in||0))),n=m.My(t.token.id_token,this.crypto.base64Decode),i=this.fromNaaAccountInfo(t.account,t.token.id_token,n),a=t.token.scope||e.scope;return{authority:t.token.authority||i.environment,uniqueId:i.localAccountId,tenantId:i.tenantId,scopes:a.split(" "),account:i,idToken:t.token.id_token,idTokenClaims:n,accessToken:t.token.access_token,fromCache:!1,expiresOn:o,tokenType:e.authenticationScheme||s.IO.BEARER,correlationId:e.correlationId,extExpiresOn:o,state:e.state}}fromNaaAccountInfo(e,t,r){const o=r||e.idTokenClaims,n=e.localAccountId||o?.oid||o?.sub||"",i=e.tenantId||o?.tid||"",a=e.homeAccountId||`${n}.${i}`,s=e.username||o?.preferred_username||"",c=e.name||o?.name,l=new Map,h=(0,C.Km)(a,n,i,o);return l.set(i,h),{homeAccountId:a,environment:e.environment,tenantId:i,username:s,localAccountId:n,name:c,idToken:t,idTokenClaims:o,tenantProfiles:l}}fromBridgeError(e){if(!function(e){return void 0!==e.status}(e))return new y.lR("unknown_error","An unknown error occurred");switch(e.status){case w.H.UserCancel:return new g.eB(p.userCanceled);case w.H.NoNetwork:return new g.eB(p.noNetworkConnectivity);case w.H.AccountUnavailable:return new g.eB(p.noAccountFound);case w.H.Disabled:return new g.eB(p.nestedAppAuthBridgeDisabled);case w.H.NestedAppAuthUnavailable:return new g.eB(e.code||p.nestedAppAuthBridgeDisabled,e.description);case w.H.TransientError:case w.H.PersistentError:return new v.g(e.code,e.description);case w.H.UserInteractionRequired:return new f.CB(e.code,e.description);default:return new y.lR(e.code,e.description)}}toAuthenticationResultFromCache(e,t,r,o,n){if(!t||!r)throw(0,g.SB)(p.nullOrEmptyToken);const i=m.My(t.secret,this.crypto.base64Decode),a=r.target||o.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:a.split(" "),account:e,idToken:t.secret,idTokenClaims:i||{},accessToken:r.secret,fromCache:!0,expiresOn:new Date(1e3*Number(r.expiresOn)),tokenType:o.authenticationScheme||s.IO.BEARER,correlationId:n,extExpiresOn:new Date(1e3*Number(r.extendedExpiresOn)),state:o.state}}}const T="unsupported_method",A="This method is not supported in nested app environment.";class b extends y.lR{constructor(e,t){super(e,t),Object.setPrototypeOf(this,b.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new b(T,A)}}var k=r(63739),E=r(29701),S=r(25568),R=r(26279);class P{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new h.M(this.logger,this.performanceClient):o.j,this.browserStorage=this.operatingContext.isBrowserEnvironment()?new S.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,(0,n.aw)(this.config.auth)):(0,S.E)(this.config.auth.clientId,this.logger),this.eventHandler=new k.J(this.logger),this.nestedAppAuthAdapter=new I(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);const r=this.bridgeProxy.getAccountContext();if(r){const e=(0,R.sU)(r,this.logger,this.browserStorage);(0,R.I$)(e,this.browserStorage)}}static async createController(e){const t=new P(e);return Promise.resolve(t)}initialize(){return Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_START,l.X8.Popup,t);const r=this.performanceClient.startMeasurement(i.MX.AcquireTokenPopup,t.correlationId);r?.add({nestedAppAuthRequest:!0});try{const o=this.nestedAppAuthAdapter.toNaaTokenRequest(t),n=a._C(),i=await this.bridgeProxy.getTokenInteractive(o),s={...this.nestedAppAuthAdapter.fromNaaTokenResponse(o,i,n)};return await this.hydrateCache(s,e),this.browserStorage.setActiveAccount(s.account),this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_SUCCESS,l.X8.Popup,s),r.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),r.end({success:!0,requestId:s.requestId}),s}catch(e){const t=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_FAILURE,l.X8.Popup,null,e),r.end({success:!1},e),t}}async acquireTokenSilentInternal(e){const t=this.ensureValidRequest(e);this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_START,l.X8.Silent,t);const r=await this.acquireTokenFromCache(t);if(r)return this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_SUCCESS,l.X8.Silent,r),r;const o=this.performanceClient.startMeasurement(i.MX.SsoSilent,t.correlationId);o?.increment({visibilityChangeCount:0}),o?.add({nestedAppAuthRequest:!0});try{const r=this.nestedAppAuthAdapter.toNaaTokenRequest(t),n=a._C(),i=await this.bridgeProxy.getTokenSilent(r),s=this.nestedAppAuthAdapter.fromNaaTokenResponse(r,i,n);return await this.hydrateCache(s,e),this.browserStorage.setActiveAccount(s.account),this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_SUCCESS,l.X8.Silent,s),o?.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),o?.end({success:!0,requestId:s.requestId}),s}catch(e){const t=this.nestedAppAuthAdapter.fromBridgeError(e);throw this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_FAILURE,l.X8.Silent,null,e),o?.end({success:!1},e),t}}async acquireTokenFromCache(e){const t=this.performanceClient.startMeasurement(i.MX.AcquireTokenSilent,e.correlationId);if(t?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("Claims are present in the request, skipping cache lookup"),null;let r=null;switch(e.cacheLookupPolicy){case l.nN.Default:case l.nN.AccessToken:case l.nN.AccessTokenAndRefreshToken:r=await this.acquireTokenFromCacheInternal(e);break;default:return null}return r?(this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_SUCCESS,l.X8.Silent,r),t?.add({accessTokenSize:r?.accessToken.length,idTokenSize:r?.idToken.length}),t?.end({success:!0}),r):(this.logger.error("Cached tokens are not found for the account, proceeding with silent token request."),this.eventHandler.emitEvent(E.B.ACQUIRE_TOKEN_FAILURE,l.X8.Silent,null),t?.end({success:!1}),null)}async acquireTokenFromCacheInternal(e){const t=this.bridgeProxy.getAccountContext();let r=null;if(t&&(r=(0,R.sU)(t,this.logger,this.browserStorage)||e.account),!r)return this.logger.verbose("No active account found, falling back to the host"),Promise.resolve(null);this.logger.verbose("active account found, attempting to acquire token silently");const o={...e,correlationId:e.correlationId||this.browserCrypto.createNewGuid(),authority:e.authority||r.environment,scopes:e.scopes?.length?e.scopes:[...s.aZ]},n=this.browserStorage.getTokenKeys(),i=this.browserStorage.getAccessToken(r,o,n,r.tenantId,this.performanceClient,o.correlationId);if(!i)return this.logger.verbose("No cached access token found"),Promise.resolve(null);if(a.XJ(i.cachedAt)||a.Hm(i.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("Cached access token has expired"),Promise.resolve(null);const c=this.browserStorage.getIdToken(r,n,r.tenantId,this.performanceClient,o.correlationId);return c?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(r,c,i,o,o.correlationId):(this.logger.verbose("No cached id token found"),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw b.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw b.createUnsupportedError()}acquireTokenNative(e,t,r){throw b.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw b.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw b.createUnsupportedError()}removePerformanceCallback(e){throw b.createUnsupportedError()}enableAccountStorageEvents(){throw b.createUnsupportedError()}disableAccountStorageEvents(){throw b.createUnsupportedError()}getAllAccounts(e){return(0,R.Is)(this.logger,this.browserStorage,this.isBrowserEnv(),e)}getAccount(e){return(0,R.sU)(e,this.logger,this.browserStorage)}getAccountByUsername(e){return(0,R.hN)(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return(0,R.PX)(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return(0,R.P6)(e,this.logger,this.browserStorage)}setActiveAccount(e){return(0,R.I$)(e,this.browserStorage)}getActiveAccount(){return(0,R.yq)(this.browserStorage)}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||l.uq)}loginRedirect(e){throw b.createUnsupportedError()}logout(e){throw b.createUnsupportedError()}logoutRedirect(e){throw b.createUnsupportedError()}logoutPopup(e){throw b.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw b.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw b.createUnsupportedError()}getRedirectResponse(){throw b.createUnsupportedError()}async clearCache(e){throw b.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=c.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r),this.browserStorage.hydrateCache(e,t)}}},42582:(e,t,r)=>{r.d(t,{i:()=>Oe});var o=r(56165),n=r(78822),i=r(21113),a=r(65925),s=r(69564),c=r(48686),l=r(44774),h=r(28952),d=r(99611),u=r(18087),g=r(47468),p=r(7936),m=r(25568),C=r(26279),v=r(51681),f=r(96121),y=r(29701),w=r(63739),I=r(86833),T=r(91755),A=r(32041),b=r(5917),k=r(81e3),E=r(71135),S=r(74553),R=r(10771),P=r(60826),N=r(94348),M=r(36979),_=r(55509);class q{constructor(e,t,r,o,n,i,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=n,this.navigationClient=i,this.nativeMessageHandler=s,this.correlationId=c||(0,_.Oy)(),this.logger=o.clone(v.Q1.MSAL_SKU,M.r,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){d.d.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(d.d.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||(0,f.getCurrentUri)();return k.H.getAbsoluteUrl(t,(0,f.getCurrentUri)())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new S.e(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const o={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},n=e.requestAuthority||this.config.auth.authority,c=r?.length?"true"===r:this.config.auth.instanceAware,l=t&&c?this.config.auth.authority.replace(k.H.getDomainFromUrl(n),t.environment):n,h=i.s4.generateAuthority(l,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),d=await(0,s.T)(R.Y,a.MX.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(h,this.config.system.networkClient,this.browserStorage,o,this.logger,this.correlationId,this.performanceClient);if(t&&!d.isAlias(t.environment))throw(0,P.aD)(N.authorityMismatch);return d}}var B=r(46093),O=r(10678),U=r(70413);async function H(e,t,r){e.addQueueMeasurement(a.MX.GeneratePkceCodes,r);const o=(0,s.l)(L,a.MX.GenerateCodeVerifier,t,e,r)(e,t,r);return{verifier:o,challenge:await(0,s.T)(D,a.MX.GenerateCodeChallengeFromVerifier,t,e,r)(o,e,t,r)}}function L(e,t,r){try{const o=new Uint8Array(32);return(0,s.l)(_.UY,a.MX.GetRandomValues,t,e,r)(o),(0,O.dB)(o)}catch(e){throw(0,B.bD)(U.pkceNotCreated)}}async function D(e,t,r,o){t.addQueueMeasurement(a.MX.GenerateCodeChallengeFromVerifier,o);try{const n=await(0,s.T)(_.sI,a.MX.Sha256Digest,r,t,o)(e,t,o);return(0,O.dB)(new Uint8Array(n))}catch(e){throw(0,B.bD)(U.pkceNotCreated)}}var K=r(36106);async function x(e,t,r,o){r.addQueueMeasurement(a.MX.InitializeBaseRequest,e.correlationId);const n=e.authority||t.auth.authority,i=[...e&&e.scopes||[]],s={...e,correlationId:e.correlationId,authority:n,scopes:i};if(s.authenticationScheme){if(s.authenticationScheme===u.IO.SSH){if(!e.sshJwk)throw(0,P.aD)(N.missingSshJwk);if(!e.sshKid)throw(0,P.aD)(N.missingSshKid)}o.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}else s.authenticationScheme=u.IO.BEARER,o.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!K.$.isEmptyObj(e.claims)&&(s.requestedClaimsHash=await(0,_.YZ)(e.claims)),s}async function z(e,t,r,o,n){o.addQueueMeasurement(a.MX.InitializeSilentRequest,e.correlationId);const i=await(0,s.T)(x,a.MX.InitializeBaseRequest,n,o,e.correlationId)(e,r,o,n);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}class F extends q{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await(0,s.T)(H,a.MX.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:u.YM.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=u.YM.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||(0,_.Oy)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=k.H.getAbsoluteUrl(e.postLogoutRedirectUri,(0,f.getCurrentUri)())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=k.H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,(0,f.getCurrentUri)())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=k.H.getAbsoluteUrl((0,f.getCurrentUri)(),(0,f.getCurrentUri)())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await(0,s.T)(this.getClientConfiguration.bind(this),a.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new E.m(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:n,account:i}=e;this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientGetClientConfiguration,this.correlationId);const c=await(0,s.T)(this.getDiscoveredAuthority.bind(this),a.MX.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:n,account:i}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:c,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:v.Q1.MSAL_SKU,version:M.r,cpu:u.YM.EMPTY_STRING,os:u.YM.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),o={interactionType:t},n=T.W.setRequestState(this.browserCrypto,e&&e.state||u.YM.EMPTY_STRING,o),i={...await(0,s.T)(x,a.MX.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:n,nonce:e.nonce||(0,_.Oy)(),responseMode:this.config.auth.OIDCOptions.serverResponseType},c=e.account||this.browserStorage.getActiveAccount();if(c&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${c.homeAccountId}`,this.correlationId),i.account=c),!i.loginHint&&!c){const e=this.browserStorage.getLegacyLoginHint();e&&(i.loginHint=e)}return i}}var X=r(4870),$=r(23202),G=r(2040),W=r(24595),Q=r(99162),j=r(21607),Y=r(23003),V=r(89451),J=r(14476),Z=r(56297);const ee="user_switch",te={[ee]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class re extends A.lR{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,re.prototype),this.name="NativeAuthError",this.ext=r}}function oe(e){return!(!e.ext||!e.ext.status||"PERSISTENT_ERROR"!==e.ext.status&&"DISABLED"!==e.ext.status)||!(!e.ext||!e.ext.error||-2147186943!==e.ext.error)||"ContentError"===e.errorCode}function ne(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return(0,c.IE)(p.nativeAccountUnavailable);case"USER_INTERACTION_REQUIRED":return new c.CB(e,t);case"USER_CANCEL":return(0,B.bD)(U.userCancelled);case"NO_NETWORK":return(0,B.bD)(U.noNetworkConnectivity)}return new re(e,te[e]||t,r)}var ie=r(70068);class ae extends F{async acquireToken(e){this.performanceClient.addQueueMeasurement(a.MX.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(v.sA.acquireTokenSilent_silentFlow),r=await(0,s.T)(this.getClientConfiguration.bind(this),a.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new ie.t(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const t=(await(0,s.T)(o.acquireCachedToken.bind(o),a.MX.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof B.jT&&e.errorCode===U.cryptoKeyNotFound&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}var se=r(37786);const ce="brk_redirect_uri";class le extends q{constructor(e,t,r,o,n,i,a,s,c,l,h,d){super(e,t,r,o,n,i,s,c,d),this.apiId=a,this.accountId=l,this.nativeMessageHandler=c,this.nativeStorageManager=h,this.silentCacheClient=new ae(e,this.nativeStorageManager,r,o,n,i,s,c,d),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const u=this.nativeMessageHandler.getExtensionId()===v.JD.PREFERRED_EXTENSION_ID?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=S.e.makeExtraSkuString({libraryName:v.Q1.MSAL_SKU,libraryVersion:M.r,extensionName:u,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[X.YB]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(a.MX.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(a.MX.NativeInteractionClientAcquireToken,e.correlationId),r=$._C();try{const o=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,o);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...n}=o,i={method:v.Ct.GetToken,request:n},a=await this.nativeMessageHandler.sendMessage(i),s=this.validateNativeResponse(a);return await this.handleNativeResponse(s,o,r).then((e=>(t.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),e))).catch((e=>{throw t.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e}))}catch(e){throw e instanceof re&&this.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:G.l.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,l.SB)(h.noAccountFound);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!r)throw(0,l.SB)(h.noAccountFound);try{const e=this.createSilentCacheRequest(t,r),o=await this.silentCacheClient.acquireToken(e),n={...r,idTokenClaims:o?.idTokenClaims,idToken:o?.idToken};return{...o,account:n}}catch(e){throw e}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const o=await this.initializeNativeRequest(r),n={method:v.Ct.GetToken,request:o};try{const e=await this.nativeMessageHandler.sendMessage(n);this.validateNativeResponse(e)}catch(e){if(e instanceof re&&(this.serverTelemetryManager.setNativeBrokerErrorCode(e.errorCode),oe(e)))throw e}this.browserStorage.setTemporaryCache(v._p.NATIVE_REQUEST,JSON.stringify(o),!0);const i={apiId:v.sA.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,i)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:o,...n}=r;o&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(v._p.NATIVE_REQUEST));const i={method:v.Ct.GetToken,request:n},a=$._C();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const e=await this.nativeMessageHandler.sendMessage(i);this.validateNativeResponse(e);const t=this.handleNativeResponse(e,n,a);this.browserStorage.setInteractionInProgress(!1);const r=await t;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),r}catch(e){throw this.browserStorage.setInteractionInProgress(!1),e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const o=W.My(e.id_token,se.u),n=this.createHomeAccountIdentifier(e,o),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId})?.homeAccountId;if(n!==i&&e.account.id!==t.accountId)throw ne(ee);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),s=(0,Q.J)(this.browserStorage,a,n,se.u,o,e.client_info,void 0,o.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,o,s,a.canonicalAuthority,r);return this.cacheAccount(s),this.cacheNativeTokens(e,t,n,o,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return d.d.generateHomeAccountId(e.client_info||u.YM.EMPTY_STRING,j.I.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?G.l.fromString(e.scope):G.l.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===u.IO.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new Y.Q(this.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,l.SB)(h.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,o)}return e.access_token}async generateAuthenticationResult(e,t,r,o,n,i){const a=this.addTelemetryFromNativeResponse(e),s=e.scope?G.l.fromString(e.scope):G.l.fromString(t.scope),c=e.account.properties||{},l=c.UID||r.oid||r.sub||u.YM.EMPTY_STRING,h=c.TenantId||r.tid||u.YM.EMPTY_STRING,d=(0,V.o9)(o.getAccountInfo(),void 0,r,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const g=await this.generatePopAccessToken(e,t),p=t.tokenType===u.IO.POP?u.IO.POP:u.IO.BEARER;return{authority:n,uniqueId:l,tenantId:h,scopes:s.asArray(),account:d,idToken:e.id_token,idTokenClaims:r,accessToken:g,fromCache:!!a&&this.isResponseFromCache(a),expiresOn:new Date(1e3*Number(i+e.expires_in)),tokenType:p,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch((e=>{this.logger.error(`Error occurred while removing account context from browser storage. ${e}`)}))}cacheNativeTokens(e,t,r,o,n,i,a){const s=J.c_(r,t.authority,e.id_token||"",t.clientId,o.tid||""),c=a+(t.tokenType===u.IO.POP?u.YM.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),h={idToken:s,accessToken:J.Np(r,t.authority,n,t.clientId,o.tid||i,l.printScopes(),c,0,se.u,void 0,t.tokenType,void 0,t.keyId)};this.nativeStorageManager.saveCacheRecord(h,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,A.pz)(Z.unexpectedError,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new k.H(t);r.validateAsUri();const{scopes:o,...n}=e,i=new G.l(o||[]);i.appendScopes(u.aZ);const c={...n,accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:(()=>{switch(this.apiId){case v.sA.ssoSilent:case v.sA.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),u._M.NONE}if(e.prompt)switch(e.prompt){case u._M.NONE:case u._M.CONSENT:case u._M.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),(0,B.bD)(U.nativePromptNotSupported)}else this.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(c.signPopToken&&e.popKid)throw(0,B.bD)(U.invalidPopTokenRequest);if(this.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry=v.JD.MATS_TELEMETRY,e.authenticationScheme===u.IO.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},r=new Y.Q(this.browserCrypto);let o;if(c.keyId)o=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{const n=await(0,s.T)(r.generateCnf.bind(r),a.MX.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(t,this.logger);o=n.reqCnfString,c.keyId=n.kid,c.signPopToken=!0}c.reqCnf=o}return this.addRequestSKUs(c),c}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty("brk_client_id")&&e.extraParameters.hasOwnProperty(ce)&&e.extraParameters.hasOwnProperty(X.U6)){const t=e.extraParameters[X.U6],r=e.redirectUri,o=e.extraParameters[ce];e.extraParameters={child_client_id:t,child_redirect_uri:r},e.redirectUri=o}}}class he{constructor(e,t,r,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(a.MX.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:v.JD.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,_.Oy)(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise(((e,r)=>{this.resolvers.set(t.responseId,{resolve:e,reject:r})}))}static async createProvider(e,t,r){e.trace("NativeMessageHandler - createProvider called.");try{const o=new he(e,t,r,v.JD.PREFERRED_EXTENSION_ID);return await o.sendHandshakeRequest(),o}catch(o){const n=new he(e,t,r);return await n.sendHandshakeRequest(),n}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:v.JD.CHANNEL_ID,extensionId:this.extensionId,responseId:(0,_.Oy)(),body:{method:v.Ct.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise(((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout((()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r((0,B.bD)(U.nativeHandshakeTimeout)),this.handshakeResolvers.delete(e.responseId)}),this.handshakeTimeoutMs)}))}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===v.JD.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===v.Ct.HandshakeRequest){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject((0,B.bD)(U.nativeExtensionNotInstalled))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if(e===v.Ct.Response){if(!r)return;const e=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)r.reject(ne(e.code,e.description,e.ext));else{if(!e.result)throw(0,A.pz)(Z.unexpectedError,"Event does not contain result.");e.result.code&&e.result.description?r.reject(ne(e.result.code,e.result.description,e.result.ext)):r.resolve(e.result)}this.resolvers.delete(t.responseId)}else if(e===v.Ct.HandshakeResponse){if(!o)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(t):o&&o.reject(t)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,o){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(o)switch(o){case u.IO.BEARER:case u.IO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}var de=r(59744),ue=r(17016);class ge{constructor(e,t,r,o,n){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=n}async handleCodeResponse(e,t){let r;this.performanceClient.addQueueMeasurement(a.MX.HandleCodeResponse,t.correlationId);try{r=this.authModule.handleFragmentResponse(e,t.state)}catch(e){throw e instanceof de.g&&e.subError===U.userCancelled?(0,B.bD)(U.userCancelled):e}return(0,s.T)(this.handleCodeResponseFromServer.bind(this),a.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(a.MX.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await(0,s.T)(this.authModule.updateAuthority.bind(this.authModule),a.MX.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await(0,s.T)(this.authModule.acquireToken.bind(this.authModule),a.MX.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:ue.X.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:ue.X.UPN}:null}}var pe=r(50970),me=r(19973);function Ce(e,t,r){const o=pe.n(e);if(!o)throw pe.S(e)?(r.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),r.errorPii(`The ${t} detected is: ${e}`),(0,B.bD)(U.hashDoesNotContainKnownProperties)):(r.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,B.bD)(U.hashEmptyError));return o}class ve extends F{constructor(e,t,r,o,n,i,a,s,c,l){super(e,t,r,o,n,i,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s}acquireToken(e){try{const t={popupName:this.generatePopupName(e.scopes||u.aZ,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),t.popup=this.openSizedPopup("about:blank",t),this.acquireTokenPopupAsync(e,t))}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},o=e&&e.authority,n=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,o,n)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,o,n))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t){this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(v.sA.acquireTokenPopup),o=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,v.X8.Popup);(0,f.preconnect)(o.authority);try{const n=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(o),i=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),c=he.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let l;c&&(l=this.performanceClient.startMeasurement(a.MX.FetchAccountIdWithNativeBroker,e.correlationId));const h=await i.getAuthCodeUrl({...o,nativeBroker:c}),d=new ge(i,this.browserStorage,n,this.logger,this.performanceClient),u=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(y.B.POPUP_OPENED,v.X8.Popup,{popupWindow:u},null);const g=await this.monitorPopupForHash(u,t.popupWindowParent),p=(0,s.l)(Ce,a.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(I.H.removeThrottle(this.browserStorage,this.config.auth.clientId,n),p.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),l&&l.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw(0,B.bD)(U.nativeConnectionNotEstablished);const e=new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,p.accountId,this.nativeStorage,o.correlationId),{userRequestState:t}=T.W.parseRequestState(this.browserCrypto,o.state);return await e.acquireToken({...o,state:t,prompt:void 0})}return await d.handleCodeResponse(p,o)}catch(e){throw t.popup?.close(),e instanceof A.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}async logoutPopupAsync(e,t,r,o){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(y.B.LOGOUT_START,v.X8.Popup,e);const n=this.initializeServerTelemetryManager(v.sA.logoutPopup);try{await this.clearCacheOnLogout(e.account);const i=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:r,account:e.account||void 0});try{i.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&i.authority.protocolMode===b.e.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId),this.eventHandler.emitEvent(y.B.LOGOUT_SUCCESS,v.X8.Popup,e),o){const e={apiId:v.sA.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=k.H.getAbsoluteUrl(o,(0,f.getCurrentUri)());await this.navigationClient.navigateInternal(t,e)}return void t.popup?.close()}}const c=i.getLogoutUri(e);this.eventHandler.emitEvent(y.B.LOGOUT_SUCCESS,v.X8.Popup,e);const l=this.openPopup(c,t);if(this.eventHandler.emitEvent(y.B.POPUP_OPENED,v.X8.Popup,{popupWindow:l},null),await this.monitorPopupForHash(l,t.popupWindowParent).catch((()=>{})),o){const e={apiId:v.sA.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=k.H.getAbsoluteUrl(o,(0,f.getCurrentUri)());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw t.popup?.close(),e instanceof A.lR&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(y.B.LOGOUT_FAILURE,v.X8.Popup,null,e),this.eventHandler.emitEvent(y.B.LOGOUT_END,v.X8.Popup),e}this.eventHandler.emitEvent(y.B.LOGOUT_END,v.X8.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,B.bD)(U.emptyNavigateUri)}monitorPopupForHash(e,t){return new Promise(((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval((()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),void r((0,B.bD)(U.userCancelled));let n="";try{n=e.location.href}catch(e){}if(!n||"about:blank"===n)return;clearInterval(o);let i="";const a=this.config.auth.OIDCOptions.serverResponseType;e&&(i=a===u.zL.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(i)}),this.config.system.pollIntervalMilliseconds)})).finally((()=>{this.cleanPopup(e,t)}))}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw(0,B.bD)(U.emptyWindowError);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(e){throw this.logger.error("error opening popup "+e.message),this.browserStorage.setInteractionInProgress(!1),(0,B.bD)(U.popupWindowError)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:o}){const n=o.screenLeft?o.screenLeft:o.screenX,i=o.screenTop?o.screenTop:o.screenY,a=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,l=r.popupSize?.height,h=r.popupPosition?.top,d=r.popupPosition?.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=v.Q1.POPUP_WIDTH),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=v.Q1.POPUP_HEIGHT),(!h||h<0||h>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,s/2-v.Q1.POPUP_HEIGHT/2+i)),(!d||d<0||d>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),d=Math.max(0,a/2-v.Q1.POPUP_WIDTH/2+n)),o.open(e,t,`width=${c}, height=${l}, top=${h}, left=${d}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(v.X8.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${v.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${v.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class fe{constructor(e,t,r,o,n){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=n}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(v._p.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(v._p.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:v.sA.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await t.navigationClient.navigateExternal(e,r)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await t.navigationClient.navigateExternal(e,r))}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,B.bD)(U.emptyNavigateUri)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const r=this.browserStorage.generateStateKey(t),o=this.browserStorage.getTemporaryCache(r);if(!o)throw(0,l.SB)(h.stateNotFound,"Cached State");let n;try{n=this.authModule.handleFragmentResponse(e,o)}catch(e){throw e instanceof de.g&&e.subError===U.userCancelled?(0,B.bD)(U.userCancelled):e}const i=this.browserStorage.generateNonceKey(o),c=this.browserStorage.getTemporaryCache(i);if(this.authCodeRequest.code=n.code,n.cloud_instance_host_name&&await(0,s.T)(this.authModule.updateAuthority.bind(this.authModule),a.MX.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(n.cloud_instance_host_name,this.authCodeRequest.correlationId),n.nonce=c||void 0,n.state=o,n.client_info)this.authCodeRequest.clientInfo=n.client_info;else{const e=this.checkCcsCredentials();e&&(this.authCodeRequest.ccsCredential=e)}const d=await this.authModule.acquireToken(this.authCodeRequest,n);return this.browserStorage.cleanRequestByState(t),d}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(v._p.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch(t){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class ye extends F{constructor(e,t,r,o,n,i,a,s,c,l){super(e,t,r,o,n,i,a,c,l),this.nativeStorage=s}async acquireToken(e){const t=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,v.X8.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const r=this.initializeServerTelemetryManager(v.sA.acquireTokenRedirect),o=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(y.B.RESTORE_FROM_BFCACHE,v.X8.Redirect))};try{const n=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),i=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),c=new fe(i,this.browserStorage,n,this.logger,this.performanceClient),l=await i.getAuthCodeUrl({...t,nativeBroker:he.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),h=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${h}`),window.addEventListener("pageshow",o),await c.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:h,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(e){throw e instanceof A.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),window.removeEventListener("pageshow",o),this.browserStorage.cleanRequestByState(t.state),e}}async handleRedirectPromise(e="",t){const r=this.initializeServerTelemetryManager(v.sA.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[o,n]=this.getRedirectResponse(e||"");if(!o)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(v.X8.Redirect),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const i=this.browserStorage.getTemporaryCache(v._p.ORIGIN_URI,!0)||u.YM.EMPTY_STRING;if(k.H.removeHashFromUrl(i)===k.H.removeHashFromUrl(window.location.href)&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),i.indexOf("#")>-1&&(0,f.replaceHash)(i),await this.handleResponse(o,r);if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(o,r);if(!(0,f.isInIframe)()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(v._p.URL_HASH,n,!0);const e={apiId:v.sA.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let t=!0;if(i&&"null"!==i)this.logger.verbose(`Navigating to loginRequestUrl: ${i}`),t=await this.navigationClient.navigateInternal(i,e);else{const r=(0,f.getHomepage)();this.browserStorage.setTemporaryCache(v._p.ORIGIN_URI,r,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),t=await this.navigationClient.navigateInternal(r,e)}if(!t)return await this.handleResponse(o,r)}return null}catch(e){throw e instanceof A.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.browserStorage.cleanRequestByInteractionType(v.X8.Redirect),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===u.zL.QUERY?window.location.search:window.location.hash);let r=pe.n(t);if(r){try{!function(e,t,r){if(!e.state)throw(0,B.bD)(U.noStateInHash);const o=(0,me.A)(t,e.state);if(!o)throw(0,B.bD)(U.unableToParseState);if(o.interactionType!==r)throw(0,B.bD)(U.stateInteractionTypeMismatch)}(r,this.browserCrypto,v.X8.Redirect)}catch(e){return e instanceof A.lR&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return(0,f.clearHash)(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const o=this.browserStorage.getTemporaryCache(v._p.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(v._p.URL_HASH)),o&&(r=pe.n(o),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,o]):[null,""]}async handleResponse(e,t){const r=e.state;if(!r)throw(0,B.bD)(U.noStateInHash);const o=this.browserStorage.getCachedRequest(r);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw(0,B.bD)(U.nativeConnectionNotEstablished);const t=new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,o.correlationId),{userRequestState:n}=T.W.parseRequestState(this.browserCrypto,r);return t.acquireToken({...o,state:n,prompt:void 0}).finally((()=>{this.browserStorage.cleanRequestByState(r)}))}const n=this.browserStorage.getCachedAuthority(r);if(!n)throw(0,B.bD)(U.noCachedAuthorityError);const i=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:n});return I.H.removeThrottle(this.browserStorage,this.config.auth.clientId,o),new fe(i,this.browserStorage,o,this.logger,this.performanceClient).handleCodeResponse(e,r)}async logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(v.sA.logout);try{this.eventHandler.emitEvent(y.B.LOGOUT_START,v.X8.Redirect,e),await this.clearCacheOnLogout(t.account);const o={apiId:v.sA.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(n.authority.protocolMode===b.e.OIDC)try{n.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return this.browserStorage.removeAccount(t.account?.homeAccountId),void this.eventHandler.emitEvent(y.B.LOGOUT_SUCCESS,v.X8.Redirect,t)}const i=n.getLogoutUri(t);if(this.eventHandler.emitEvent(y.B.LOGOUT_SUCCESS,v.X8.Redirect,t),!e||"function"!=typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(i,o);if(!1!==e.onRedirectNavigate(i))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),void await this.navigationClient.navigateExternal(i,o);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof A.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(y.B.LOGOUT_FAILURE,v.X8.Redirect,null,e),this.eventHandler.emitEvent(y.B.LOGOUT_END,v.X8.Redirect),e}this.eventHandler.emitEvent(y.B.LOGOUT_END,v.X8.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return k.H.getAbsoluteUrl(t,(0,f.getCurrentUri)())}}var we=r(8297);async function Ie(e,t,r,o,n){if(t.addQueueMeasurement(a.MX.SilentHandlerInitiateAuthRequest,o),!e)throw r.info("Navigate url is empty"),(0,B.bD)(U.emptyNavigateUri);return n?(0,s.T)(Ae,a.MX.SilentHandlerLoadFrame,r,t,o)(e,n,t,o):(0,s.l)(be,a.MX.SilentHandlerLoadFrameSync,r,t,o)(e)}async function Te(e,t,r,o,n,i,c){return o.addQueueMeasurement(a.MX.SilentHandlerMonitorIframeForHash,i),new Promise(((o,i)=>{t<we.YH&&n.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${we.YH}ms). This may result in timeouts.`);const a=window.setTimeout((()=>{window.clearInterval(s),i((0,B.bD)(U.monitorWindowTimeout))}),t),s=window.setInterval((()=>{let t="";const r=e.contentWindow;try{t=r?r.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let n="";r&&(n=c===u.zL.QUERY?r.location.search:r.location.hash),window.clearTimeout(a),window.clearInterval(s),o(n)}),r)})).finally((()=>{(0,s.l)(Ee,a.MX.RemoveHiddenIframe,n,o,i)(e)}))}function Ae(e,t,r,o){return r.addQueueMeasurement(a.MX.SilentHandlerLoadFrame,o),new Promise(((r,o)=>{const n=ke();window.setTimeout((()=>{n?(n.src=e,r(n)):o("Unable to load iframe")}),t)}))}function be(e){const t=ke();return t.src=e,t}function ke(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function Ee(e){document.body===e.parentNode&&document.body.removeChild(e)}class Se extends F{constructor(e,t,r,o,n,i,a,s,c,l,h){super(e,t,r,o,n,i,s,l,h),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(a.MX.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==u._M.NONE&&t.prompt!==u._M.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${u._M.NONE}`),t.prompt=u._M.NONE):t.prompt=u._M.NONE;const r=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,v.X8.Silent);(0,f.preconnect)(r.authority);const o=this.initializeServerTelemetryManager(this.apiId);let n;try{return n=await(0,s.T)(this.createAuthCodeClient.bind(this),a.MX.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),await(0,s.T)(this.silentTokenHelper.bind(this),a.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(n,r)}catch(r){if(r instanceof A.lR&&(r.setCorrelationId(this.correlationId),o.cacheFailedRequest(r)),!(n&&r instanceof A.lR&&r.errorCode===v.Q1.INVALID_GRANT_ERROR))throw r;this.performanceClient.addFields({retryError:r.errorCode},this.correlationId);const i=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,v.X8.Silent);return await(0,s.T)(this.silentTokenHelper.bind(this),a.MX.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(n,i)}}logout(){return Promise.reject((0,B.bD)(U.silentLogoutUnsupported))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(a.MX.SilentIframeClientTokenHelper,r);const o=await(0,s.T)(this.initializeAuthorizationCodeRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,r)(t),n=await(0,s.T)(e.getAuthCodeUrl.bind(e),a.MX.GetAuthCodeUrl,this.logger,this.performanceClient,r)({...t,nativeBroker:he.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),i=new ge(e,this.browserStorage,o,this.logger,this.performanceClient),c=await(0,s.T)(Ie,a.MX.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(n,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,h=await(0,s.T)(Te,a.MX.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,l),d=(0,s.l)(Ce,a.MX.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(h,l,this.logger);if(d.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw(0,B.bD)(U.nativeConnectionNotEstablished);const e=new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,d.accountId,this.browserStorage,r),{userRequestState:o}=T.W.parseRequestState(this.browserCrypto,t.state);return(0,s.T)(e.acquireToken.bind(e),a.MX.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,r)({...t,state:o,prompt:t.prompt||u._M.NONE})}return(0,s.T)(i.handleCodeResponse.bind(i),a.MX.HandleCodeResponse,this.logger,this.performanceClient,r)(d,t)}}var Re=r(48719);class Pe extends F{async acquireToken(e){this.performanceClient.addQueueMeasurement(a.MX.SilentRefreshClientAcquireToken,e.correlationId);const t=await(0,s.T)(x,a.MX.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const o=this.initializeServerTelemetryManager(v.sA.acquireTokenSilent_silentFlow),n=await this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return(0,s.T)(n.acquireTokenByRefreshToken.bind(n),a.MX.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch((e=>{throw e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e),e}))}logout(){return Promise.reject((0,B.bD)(U.silentLogoutUnsupported))}async createRefreshTokenClient(e){const t=await(0,s.T)(this.getClientConfiguration.bind(this),a.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Re.O(t,this.performanceClient)}}class Ne{constructor(e,t,r,o){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=r,this.cryptoObj=o}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw(0,B.bD)(U.nonBrowserEnvironment);const o=t.id_token?W.My(t.id_token,se.u):void 0,n={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new i.s4(i.s4.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,n,this.logger,e.correlationId||(0,_.Oy)()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",o,a),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm),l=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r),h=this.loadRefreshToken(t,s.homeAccountId,s.environment);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:l,refreshToken:h},o,a)}loadAccount(e,t,r,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const t=d.d.createFromAccountInfo(e.account);return this.storage.setAccount(t),t}if(!o||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),(0,B.bD)(U.unableToLoadToken);const n=d.d.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,r),i=r?.tid,a=(0,Q.J)(this.storage,o,n,se.u,r,t,o.hostnameAndPort,i,void 0,void 0,this.logger);return this.storage.setAccount(a),a}loadIdToken(e,t,r,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const n=J.c_(t,r,e.id_token,this.config.auth.clientId,o);return this.storage.setIdTokenCredential(n),n}loadAccessToken(e,t,r,o,n,i){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const a=t.scope?G.l.fromString(t.scope):new G.l(e.scopes),s=i.expiresOn||t.expires_in+(new Date).getTime()/1e3,c=i.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,l=J.Np(r,o,t.access_token,this.config.auth.clientId,n,a.printScopes(),s,c,se.u);return this.storage.setAccessTokenCredential(l),l}loadRefreshToken(e,t,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=J.Mg(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(o),o}generateAuthenticationResult(e,t,r,o){let n,i="",a=[],s=null;t?.accessToken&&(i=t.accessToken.secret,a=G.l.fromString(t.accessToken.target).asArray(),s=new Date(1e3*Number(t.accessToken.expiresOn)),n=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));const c=t.account;return{authority:o?o.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:c.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:i,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:n,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}class Me extends E.m{constructor(e){super(e),this.includeRedirectUri=!1}}class _e extends F{constructor(e,t,r,o,n,i,a,s,c,l){super(e,t,r,o,n,i,s,c,l),this.apiId=a}async acquireToken(e){if(!e.code)throw(0,B.bD)(U.authCodeRequired);const t=await(0,s.T)(this.initializeAuthorizationRequest.bind(this),a.MX.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,v.X8.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const o={...t,code:e.code},n=await(0,s.T)(this.getClientConfiguration.bind(this),a.MX.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),i=new Me(n);this.logger.verbose("Auth code client created");const c=new ge(i,this.browserStorage,o,this.logger,this.performanceClient);return await(0,s.T)(c.handleCodeResponseFromServer.bind(c),a.MX.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(e){throw e instanceof A.lR&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return Promise.reject((0,B.bD)(U.silentLogoutUnsupported))}}function qe(e){const t=e?.idTokenClaims;return t?.tfp||t?.acr?"B2C":t?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===t?.tid?"MSA":"AAD":void 0}function Be(e,t){try{(0,f.preflightCheck)(e)}catch(e){throw t.end({success:!1},e),e}}class Oe{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new o.M(this.logger,this.performanceClient):n.j,this.eventHandler=new w.J(this.logger),this.browserStorage=this.isBrowserEnvironment?new m.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,(0,i.aw)(this.config.auth),this.performanceClient):(0,m.E)(this.config.auth.clientId,this.logger);const t={cacheLocation:v.Al.MemoryStorage,temporaryCacheLocation:v.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new m.c(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Ne(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static async createController(e,t){const r=new Oe(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment)return this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,void this.eventHandler.emitEvent(y.B.INITIALIZE_END);const t=e?.correlationId||this.getRequestCorrelationId(),r=this.config.system.allowNativeBroker,o=this.performanceClient.startMeasurement(a.MX.InitializeClientApplication,t);if(this.eventHandler.emitEvent(y.B.INITIALIZE_START),r)try{this.nativeExtensionProvider=await he.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await(0,s.T)(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),a.MX.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(y.B.INITIALIZE_END),o.end({allowNativeBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),(0,f.blockAPICallsBeforeInitialize)(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),o=r&&he.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,n=o?r?.correlationId:this.browserStorage.getTemporaryCache(v._p.CORRELATION_ID,!0)||"",i=this.performanceClient.startMeasurement(a.MX.AcquireTokenRedirect,n);let c;if(this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_START,v.X8.Redirect),o&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const e=new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,r.accountId,this.nativeInternalStorage,r.correlationId);c=(0,s.T)(e.handleRedirectPromise.bind(e),a.MX.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,i.event.correlationId)(this.performanceClient,i.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const t=this.createRedirectClient(n);c=(0,s.T)(t.handleRedirectPromise.bind(t),a.MX.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,i.event.correlationId)(e,i)}return c.then((e=>(e?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(y.B.LOGIN_SUCCESS,v.X8.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,v.X8.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),i.end({success:!0,accountType:qe(e.account)})):i.event.errorCode?i.end({success:!1}):i.discard(),this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_END,v.X8.Redirect),e))).catch((e=>{const r=e;throw t.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,v.X8.Redirect,null,r):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,v.X8.Redirect,null,r),this.eventHandler.emitEvent(y.B.HANDLE_REDIRECT_END,v.X8.Redirect),i.end({success:!1},r),e}))}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(a.MX.AcquireTokenPreRedirect,t);r.add({accountType:qe(e.account),scenarioId:e.scenarioId});const o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=e=>{const t="function"==typeof o?o(e):void 0;return!1!==t?r.end({success:!0}):r.discard(),t};else{const e=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const o="function"==typeof e?e(t):void 0;return!1!==o?r.end({success:!0}):r.discard(),o}}const n=this.getAllAccounts().length>0;try{let o;return(0,f.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),n?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,v.X8.Redirect,e):this.eventHandler.emitEvent(y.B.LOGIN_START,v.X8.Redirect,e),o=this.nativeExtensionProvider&&this.canUseNative(e)?new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch((r=>{if(r instanceof re&&oe(r))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(r instanceof c.CB)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),r})):this.createRedirectClient(t).acquireToken(e),await o}catch(e){throw r.end({success:!1},e),n?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,v.X8.Redirect,null,e):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,v.X8.Redirect,null,e),e}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(a.MX.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:qe(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Be(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(e){return Promise.reject(e)}const o=this.getAllAccounts();let n;return o.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,v.X8.Popup,e):this.eventHandler.emitEvent(y.B.LOGIN_START,v.X8.Popup,e),n=this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},v.sA.acquireTokenPopup).then((e=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,requestId:e.requestId,accountType:qe(e.account)}),e))).catch((r=>{if(r instanceof re&&oe(r))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(r instanceof c.CB)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),r})):this.createPopupClient(t).acquireToken(e),n.then((e=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(y.B.LOGIN_SUCCESS,v.X8.Popup,e):this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,v.X8.Popup,e),r.end({success:!0,requestId:e.requestId,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:qe(e.account)}),e))).catch((e=>(o.length>0?this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,v.X8.Popup,null,e):this.eventHandler.emitEvent(y.B.LOGIN_FAILURE,v.X8.Popup,null,e),r.end({success:!1},e),Promise.reject(e))))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};let o;return this.ssoSilentMeasurement=this.performanceClient.startMeasurement(a.MX.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:qe(e.account)}),Be(this.initialized,this.ssoSilentMeasurement),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(y.B.SSO_SILENT_START,v.X8.Silent,r),o=this.canUseNative(r)?this.acquireTokenNative(r,v.sA.ssoSilent).catch((e=>{if(e instanceof re&&oe(e))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw e})):this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then((e=>(this.eventHandler.emitEvent(y.B.SSO_SILENT_SUCCESS,v.X8.Silent,e),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:qe(e.account)}),e))).catch((e=>{throw this.eventHandler.emitEvent(y.B.SSO_SILENT_FAILURE,v.X8.Silent,null,e),this.ssoSilentMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(a.MX.AcquireTokenByCode,t);Be(this.initialized,r),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_START,v.X8.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw(0,B.bD)(U.spaCodeAndNativeAccountIdPresent);if(e.code){const o=e.code;let n=this.hybridAuthCodeResponses.get(o);return n?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),n=this.acquireTokenByCodeAsync({...e,correlationId:t}).then((e=>(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_SUCCESS,v.X8.Silent,e),this.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length,accountType:qe(e.account)}),e))).catch((e=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,v.X8.Silent,null,e),r.end({success:!1},e),e})),this.hybridAuthCodeResponses.set(o,n)),await n}if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId)){const o=await this.acquireTokenNative({...e,correlationId:t},v.sA.acquireTokenByCode,e.nativeAccountId).catch((e=>{throw e instanceof re&&oe(e)&&(this.nativeExtensionProvider=void 0),e}));return r.end({accountType:qe(o.account),success:!0}),o}throw(0,B.bD)(U.unableToAcquireTokenFromNativePlatform)}throw(0,B.bD)(U.authCodeOrNativeAccountIdRequired)}catch(e){throw this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,v.X8.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(a.MX.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then((e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e))).catch((e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenFromCache,e.correlationId),t){case v.nN.Default:case v.nN.AccessToken:case v.nN.AccessTokenAndRefreshToken:const t=this.createSilentCacheClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,l.SB)(h.tokenRefreshRequired)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenByRefreshToken,e.correlationId),t){case v.nN.Default:case v.nN.AccessTokenAndRefreshToken:case v.nN.RefreshToken:case v.nN.RefreshTokenAndNetwork:const t=this.createSilentRefreshClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw(0,l.SB)(h.tokenRefreshRequired)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return(0,s.T)(t.acquireToken.bind(t),a.MX.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return(0,f.redirectPreflightCheck)(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return(0,f.preflightCheck)(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return(0,C.Is)(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return(0,C.sU)(e,this.logger,this.browserStorage)}getAccountByUsername(e){return(0,C.hN)(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return(0,C.PX)(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return(0,C.P6)(e,this.logger,this.browserStorage)}setActiveAccount(e){(0,C.I$)(e,this.browserStorage)}getActiveAccount(){return(0,C.yq)(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=d.d.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw(0,B.bD)(U.nativeConnectionNotEstablished);return new le(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!he.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case u._M.NONE:case u._M.CONSENT:case u._M.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new ve(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new ye(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Se(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new ae(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Pe(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new _e(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,v.sA.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return(0,f.blockNonBrowserEnvironment)(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){"undefined"!=typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes(u.Gd.ACTIVE_ACCOUNT_FILTERS)&&this.eventHandler.emitEvent(y.B.ACTIVE_ACCOUNT_CHANGED);const t=e.newValue||e.oldValue;if(!t)return;const r=JSON.parse(t);if("object"!=typeof r||!d.d.isAccountEntity(r))return;const o=g.G.toObject(new d.d,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent(y.B.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent(y.B.ACCOUNT_REMOVED,void 0,o))}catch(e){return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,_.Oy)():u.YM.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||v.uq})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||v.uq})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(a.MX.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Be(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const o=e.account||this.getActiveAccount();if(!o)throw(0,B.bD)(U.noAccountError);r.add({accountType:qe(o)});const n={clientId:this.config.auth.clientId,authority:e.authority||u.YM.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},i=JSON.stringify(n),c=this.activeSilentTokenRequests.get(i);if(void 0===c){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const n=(0,s.T)(this.acquireTokenSilentAsync.bind(this),a.MX.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},o).then((t=>(this.activeSilentTokenRequests.delete(i),r.end({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:t.requestId,accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length}),t))).catch((e=>{throw this.activeSilentTokenRequests.delete(i),r.end({success:!1},e),e}));return this.activeSilentTokenRequests.set(i,n),{...await n,state:e.state}}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discard(),{...await c,state:e.state}}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(a.MX.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_START,v.X8.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const o=await(0,s.T)(z,a.MX.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),n=e.cacheLookupPolicy||v.nN.Default;return this.acquireTokenSilentNoIframe(o,n).catch((async e=>{const t=function(e,t){const r=!(e instanceof c.CB&&e.subError!==p.badToken),o=e.errorCode===v.Q1.INVALID_GRANT_ERROR||e.errorCode===h.tokenRefreshRequired,n=r&&o||e.errorCode===p.noTokensFound||e.errorCode===p.refreshTokenExpired,i=v.JE.includes(t);return n&&i}(e,n);if(t){if(this.activeIframeRequest){if(n!==v.nN.Skip){const[t,r]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${r}`,o.correlationId);const i=this.performanceClient.startMeasurement(a.MX.AwaitConcurrentIframe,o.correlationId);i.add({awaitIframeCorrelationId:r});const s=await t;if(i.end({success:s}),s)return this.logger.verbose(`Parallel iframe request with correlationId: ${r} succeeded. Retrying cache and/or RT redemption`,o.correlationId),this.acquireTokenSilentNoIframe(o,n);throw this.logger.info(`Iframe request with correlationId: ${r} failed. Interaction is required.`),e}return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),a.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o)}{let e;return this.activeIframeRequest=[new Promise((t=>{e=t})),o.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),(0,s.T)(this.acquireTokenBySilentIframe.bind(this),a.MX.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o).then((t=>(e(!0),t))).catch((t=>{throw e(!1),t})).finally((()=>{this.activeIframeRequest=void 0}))}}throw e})).then((t=>(this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_SUCCESS,v.X8.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker,requestId:t.requestId},e.correlationId),t))).catch((e=>{throw this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_FAILURE,v.X8.Silent,null,e),e})).finally((()=>{document.removeEventListener("visibilitychange",r)}))}async acquireTokenSilentNoIframe(e,t){return he.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,v.sA.acquireTokenSilent_silentFlow).catch((async e=>{if(e instanceof re&&oe(e))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,(0,l.SB)(h.tokenRefreshRequired);throw e}))):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),(0,s.T)(this.acquireTokenFromCache.bind(this),a.MX.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch((r=>{if(t===v.nN.AccessToken)throw r;return this.eventHandler.emitEvent(y.B.ACQUIRE_TOKEN_NETWORK_START,v.X8.Silent,e),(0,s.T)(this.acquireTokenByRefreshToken.bind(this),a.MX.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)})))}}},55509:(e,t,r)=>{r.d(t,{Oy:()=>v,RI:()=>y,RW:()=>g,TZ:()=>f,UY:()=>m,W6:()=>w,YZ:()=>T,_S:()=>I,sI:()=>p});var o=r(46093),n=r(65925),i=r(51681),a=r(10678),s=r(70413);const c="SHA-256",l=new Uint8Array([1,0,1]),h="0123456789abcdef",d=new Uint32Array(1),u={name:"RSASSA-PKCS1-v1_5",hash:c,modulusLength:2048,publicExponent:l};function g(e){if(!("crypto"in window))throw e.error("BrowserCrypto: crypto interface is unavailable"),(0,o.bD)(s.cryptoNonExistent);e.verbose("BrowserCrypto: modern crypto interface available")}async function p(e,t,r){t?.addQueueMeasurement(n.MX.Sha256Digest,r);const o=(new TextEncoder).encode(e);return window.crypto.subtle.digest(c,o)}function m(e){return window.crypto.getRandomValues(e)}function C(){return window.crypto.getRandomValues(d),d[0]}function v(){const e=Date.now(),t=1024*C()+(1023&C()),r=new Uint8Array(16),o=Math.trunc(t/2**30),n=t&2**30-1,i=C();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|o>>>8,r[7]=o,r[8]=128|n>>>24,r[9]=n>>>16,r[10]=n>>>8,r[11]=n,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;let a="";for(let e=0;e<r.length;e++)a+=h.charAt(r[e]>>>4),a+=h.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(a+="-");return a}async function f(e,t){return window.crypto.subtle.generateKey(u,e,t)}async function y(e){return window.crypto.subtle.exportKey(i.jb,e)}async function w(e,t,r){return window.crypto.subtle.importKey(i.jb,e,u,t,r)}async function I(e,t){return window.crypto.subtle.sign(u,e,t)}async function T(e){const t=await p(e),r=new Uint8Array(t);return(0,a.dB)(r)}},56165:(e,t,r)=>{r.d(t,{M:()=>p});var o=r(65925),n=r(32298),i=r(10678),a=r(37786),s=r(55509),c=r(46093),l=r(51681),h=r(70413);class d{constructor(){this.dbName=l.$u,this.version=l.G8,this.tableName=l.WJ,this.dbOpen=!1}async open(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(this.tableName)})),r.addEventListener("success",(t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()})),r.addEventListener("error",(()=>t((0,c.bD)(h.databaseUnavailable))))}))}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,c.bD)(h.databaseNotOpen));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(r.target.result)})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async setItem(e,t){return await this.validateDbIsOpen(),new Promise(((r,o)=>{if(!this.db)return o((0,c.bD)(h.databaseNotOpen));const n=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);n.addEventListener("success",(()=>{this.closeConnection(),r()})),n.addEventListener("error",(e=>{this.closeConnection(),o(e)}))}))}async removeItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,c.bD)(h.databaseNotOpen));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",(()=>{this.closeConnection(),t()})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async getKeys(){return await this.validateDbIsOpen(),new Promise(((e,t)=>{if(!this.db)return t((0,c.bD)(h.databaseNotOpen));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",(t=>{const r=t;this.closeConnection(),e(r.target.result)})),r.addEventListener("error",(e=>{this.closeConnection(),t(e)}))}))}async containsKey(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r((0,c.bD)(h.databaseNotOpen));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(1===r.target.result)})),o.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise(((e,t)=>{const r=window.indexedDB.deleteDatabase(l.$u),o=setTimeout((()=>t(!1)),200);r.addEventListener("success",(()=>(clearTimeout(o),e(!0)))),r.addEventListener("blocked",(()=>(clearTimeout(o),e(!0)))),r.addEventListener("error",(()=>(clearTimeout(o),t(!1))))}))}}var u=r(83359);class g{constructor(e){this.inMemoryCache=new u.X,this.indexedDBCache=new d,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof c.jT&&e.errorCode===h.databaseUnavailable))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class p{constructor(e,t){this.logger=e,(0,s.RW)(e),this.cache=new g(this.logger),this.performanceClient=t}createNewGuid(){return(0,s.Oy)()}base64Encode(e){return(0,i.KA)(e)}base64Decode(e){return(0,a.u)(e)}base64UrlEncode(e){return(0,i.u4)(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(o.MX.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await(0,s.TZ)(p.EXTRACTABLE,p.POP_KEY_USAGES),n=await(0,s.RI)(r.publicKey),i=m({e:n.e,kty:n.kty,n:n.n}),a=await this.hashString(i),c=await(0,s.RI)(r.privateKey),l=await(0,s.W6)(c,!1,["sign"]);return await this.cache.setItem(a,{privateKey:l,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,a){const l=this.performanceClient?.startMeasurement(o.MX.CryptoOptsSignJwt,a),d=await this.cache.getItem(t);if(!d)throw(0,c.bD)(h.cryptoKeyNotFound);const u=await(0,s.RI)(d.publicKey),g=m(u),p=(0,i.u4)(JSON.stringify({kid:t})),C=n.p.getShrHeaderString({...r?.header,alg:u.alg,kid:p}),v=(0,i.u4)(C);e.cnf={jwk:JSON.parse(g)};const f=`${v}.${(0,i.u4)(JSON.stringify(e))}`,y=(new TextEncoder).encode(f),w=await(0,s._S)(d.privateKey,y),I=`${f}.${(0,i.dB)(new Uint8Array(w))}`;return l&&l.end({success:!0}),I}async hashString(e){return(0,s.YZ)(e)}}function m(e){return JSON.stringify(e,Object.keys(e).sort())}p.POP_KEY_USAGES=["sign","verify"],p.EXTRACTABLE=!0},58501:(e,t,r)=>{r.d(t,{a:()=>s});var o=r(56165),n=r(78705),i=r(23003),a=r(36979);class s{constructor(e,t){const r=t&&t.loggerOptions||{};this.logger=new n.V(r,a.U,a.r),this.cryptoOps=new o.M(this.logger),this.popTokenGenerator=new i.Q(this.cryptoOps),this.shrParameters=e}async generatePublicKeyThumbprint(){const{kid:e}=await this.popTokenGenerator.generateKid(this.shrParameters);return e}async signRequest(e,t,r){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,r)}async removeKeys(e){return this.cryptoOps.removeTokenBindingKey(e)}}},37786:(e,t,r)=>{r.d(t,{u:()=>i});var o=r(46093),n=r(70413);function i(e){return(new TextDecoder).decode(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw(0,o.bD)(n.invalidBase64String)}const r=atob(t);return Uint8Array.from(r,(e=>e.codePointAt(0)||0))}(e))}},10678:(e,t,r)=>{function o(e){return encodeURIComponent(i(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function n(e){return a(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function i(e){return a((new TextEncoder).encode(e))}function a(e){const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return btoa(t)}r.d(t,{KA:()=>i,dB:()=>n,u4:()=>o})},46093:(e,t,r)=>{r.d(t,{UP:()=>s,bD:()=>l,jT:()=>c});var o=r(32041),n=r(70413);const i="For more visit: aka.ms/msaljs/browser-errors",a={[n.pkceNotCreated]:"The PKCE code challenge and verifier could not be generated.",[n.cryptoNonExistent]:"The crypto object or function is not available.",[n.emptyNavigateUri]:"Navigation URI is empty. Please check stack trace for more info.",[n.hashEmptyError]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${i}`,[n.noStateInHash]:"Hash does not contain state. Please verify that the request originated from msal.",[n.hashDoesNotContainKnownProperties]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${i}`,[n.unableToParseState]:"Unable to parse state. Please verify that the request originated from msal.",[n.stateInteractionTypeMismatch]:"Hash contains state but the interaction type does not match the caller.",[n.interactionInProgress]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${i}`,[n.popupWindowError]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[n.emptyWindowError]:"window.open returned null or undefined window object.",[n.userCancelled]:"User cancelled the flow.",[n.monitorPopupTimeout]:`Token acquisition in popup failed due to timeout.  ${i}`,[n.monitorWindowTimeout]:`Token acquisition in iframe failed due to timeout.  ${i}`,[n.redirectInIframe]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[n.blockIframeReload]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${i}`,[n.blockNestedPopups]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[n.iframeClosedPrematurely]:"The iframe being monitored was closed prematurely.",[n.silentLogoutUnsupported]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[n.noAccountError]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[n.silentPromptValueError]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[n.noTokenRequestCacheError]:"No token request found in cache.",[n.unableToParseTokenRequestCacheError]:"The cached token request could not be parsed.",[n.noCachedAuthorityError]:"No cached authority found.",[n.authRequestNotSetError]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[n.invalidCacheType]:"Invalid cache type",[n.nonBrowserEnvironment]:"Login and token requests are not supported in non-browser environments.",[n.databaseNotOpen]:"Database is not open!",[n.noNetworkConnectivity]:"No network connectivity. Check your internet connection.",[n.postRequestFailed]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[n.getRequestFailed]:"Network request failed. Please check the network trace to determine root cause.",[n.failedToParseResponse]:"Failed to parse network response. Check network trace.",[n.unableToLoadToken]:"Error loading token to cache.",[n.cryptoKeyNotFound]:"Cryptographic Key or Keypair not found in browser storage.",[n.authCodeRequired]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[n.authCodeOrNativeAccountIdRequired]:"An authorization code or nativeAccountId must be provided to this flow.",[n.spaCodeAndNativeAccountIdPresent]:"Request cannot contain both spa code and native account id.",[n.databaseUnavailable]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[n.unableToAcquireTokenFromNativePlatform]:`Unable to acquire token from native platform.  ${i}`,[n.nativeHandshakeTimeout]:"Timed out while attempting to establish connection to browser extension",[n.nativeExtensionNotInstalled]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[n.nativeConnectionNotEstablished]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${i}`,[n.uninitializedPublicClientApplication]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${i}`,[n.nativePromptNotSupported]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[n.invalidBase64String]:"Invalid base64 encoded string.",[n.invalidPopTokenRequest]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true."},s={pkceNotGenerated:{code:n.pkceNotCreated,desc:a[n.pkceNotCreated]},cryptoDoesNotExist:{code:n.cryptoNonExistent,desc:a[n.cryptoNonExistent]},emptyNavigateUriError:{code:n.emptyNavigateUri,desc:a[n.emptyNavigateUri]},hashEmptyError:{code:n.hashEmptyError,desc:a[n.hashEmptyError]},hashDoesNotContainStateError:{code:n.noStateInHash,desc:a[n.noStateInHash]},hashDoesNotContainKnownPropertiesError:{code:n.hashDoesNotContainKnownProperties,desc:a[n.hashDoesNotContainKnownProperties]},unableToParseStateError:{code:n.unableToParseState,desc:a[n.unableToParseState]},stateInteractionTypeMismatchError:{code:n.stateInteractionTypeMismatch,desc:a[n.stateInteractionTypeMismatch]},interactionInProgress:{code:n.interactionInProgress,desc:a[n.interactionInProgress]},popupWindowError:{code:n.popupWindowError,desc:a[n.popupWindowError]},emptyWindowError:{code:n.emptyWindowError,desc:a[n.emptyWindowError]},userCancelledError:{code:n.userCancelled,desc:a[n.userCancelled]},monitorPopupTimeoutError:{code:n.monitorPopupTimeout,desc:a[n.monitorPopupTimeout]},monitorIframeTimeoutError:{code:n.monitorWindowTimeout,desc:a[n.monitorWindowTimeout]},redirectInIframeError:{code:n.redirectInIframe,desc:a[n.redirectInIframe]},blockTokenRequestsInHiddenIframeError:{code:n.blockIframeReload,desc:a[n.blockIframeReload]},blockAcquireTokenInPopupsError:{code:n.blockNestedPopups,desc:a[n.blockNestedPopups]},iframeClosedPrematurelyError:{code:n.iframeClosedPrematurely,desc:a[n.iframeClosedPrematurely]},silentLogoutUnsupportedError:{code:n.silentLogoutUnsupported,desc:a[n.silentLogoutUnsupported]},noAccountError:{code:n.noAccountError,desc:a[n.noAccountError]},silentPromptValueError:{code:n.silentPromptValueError,desc:a[n.silentPromptValueError]},noTokenRequestCacheError:{code:n.noTokenRequestCacheError,desc:a[n.noTokenRequestCacheError]},unableToParseTokenRequestCacheError:{code:n.unableToParseTokenRequestCacheError,desc:a[n.unableToParseTokenRequestCacheError]},noCachedAuthorityError:{code:n.noCachedAuthorityError,desc:a[n.noCachedAuthorityError]},authRequestNotSet:{code:n.authRequestNotSetError,desc:a[n.authRequestNotSetError]},invalidCacheType:{code:n.invalidCacheType,desc:a[n.invalidCacheType]},notInBrowserEnvironment:{code:n.nonBrowserEnvironment,desc:a[n.nonBrowserEnvironment]},databaseNotOpen:{code:n.databaseNotOpen,desc:a[n.databaseNotOpen]},noNetworkConnectivity:{code:n.noNetworkConnectivity,desc:a[n.noNetworkConnectivity]},postRequestFailed:{code:n.postRequestFailed,desc:a[n.postRequestFailed]},getRequestFailed:{code:n.getRequestFailed,desc:a[n.getRequestFailed]},failedToParseNetworkResponse:{code:n.failedToParseResponse,desc:a[n.failedToParseResponse]},unableToLoadTokenError:{code:n.unableToLoadToken,desc:a[n.unableToLoadToken]},signingKeyNotFoundInStorage:{code:n.cryptoKeyNotFound,desc:a[n.cryptoKeyNotFound]},authCodeRequired:{code:n.authCodeRequired,desc:a[n.authCodeRequired]},authCodeOrNativeAccountRequired:{code:n.authCodeOrNativeAccountIdRequired,desc:a[n.authCodeOrNativeAccountIdRequired]},spaCodeAndNativeAccountPresent:{code:n.spaCodeAndNativeAccountIdPresent,desc:a[n.spaCodeAndNativeAccountIdPresent]},databaseUnavailable:{code:n.databaseUnavailable,desc:a[n.databaseUnavailable]},unableToAcquireTokenFromNativePlatform:{code:n.unableToAcquireTokenFromNativePlatform,desc:a[n.unableToAcquireTokenFromNativePlatform]},nativeHandshakeTimeout:{code:n.nativeHandshakeTimeout,desc:a[n.nativeHandshakeTimeout]},nativeExtensionNotInstalled:{code:n.nativeExtensionNotInstalled,desc:a[n.nativeExtensionNotInstalled]},nativeConnectionNotEstablished:{code:n.nativeConnectionNotEstablished,desc:a[n.nativeConnectionNotEstablished]},uninitializedPublicClientApplication:{code:n.uninitializedPublicClientApplication,desc:a[n.uninitializedPublicClientApplication]},nativePromptNotSupported:{code:n.nativePromptNotSupported,desc:a[n.nativePromptNotSupported]},invalidBase64StringError:{code:n.invalidBase64String,desc:a[n.invalidBase64String]},invalidPopTokenRequest:{code:n.invalidPopTokenRequest,desc:a[n.invalidPopTokenRequest]}};class c extends o.lR{constructor(e){super(e,a[e]),Object.setPrototypeOf(this,c.prototype),this.name="BrowserAuthError"}}function l(e){return new c(e)}},70413:(e,t,r)=>{r.r(t),r.d(t,{authCodeOrNativeAccountIdRequired:()=>L,authCodeRequired:()=>H,authRequestNotSetError:()=>S,blockIframeReload:()=>f,blockNestedPopups:()=>y,cryptoKeyNotFound:()=>U,cryptoNonExistent:()=>n,databaseNotOpen:()=>N,databaseUnavailable:()=>K,emptyNavigateUri:()=>i,emptyWindowError:()=>g,failedToParseResponse:()=>B,getRequestFailed:()=>q,hashDoesNotContainKnownProperties:()=>c,hashEmptyError:()=>a,iframeClosedPrematurely:()=>w,interactionInProgress:()=>d,invalidBase64String:()=>W,invalidCacheType:()=>R,invalidPopTokenRequest:()=>Q,monitorPopupTimeout:()=>m,monitorWindowTimeout:()=>C,nativeConnectionNotEstablished:()=>X,nativeExtensionNotInstalled:()=>F,nativeHandshakeTimeout:()=>z,nativePromptNotSupported:()=>G,noAccountError:()=>T,noCachedAuthorityError:()=>E,noNetworkConnectivity:()=>M,noStateInHash:()=>s,noTokenRequestCacheError:()=>b,nonBrowserEnvironment:()=>P,pkceNotCreated:()=>o,popupWindowError:()=>u,postRequestFailed:()=>_,redirectInIframe:()=>v,silentLogoutUnsupported:()=>I,silentPromptValueError:()=>A,spaCodeAndNativeAccountIdPresent:()=>D,stateInteractionTypeMismatch:()=>h,unableToAcquireTokenFromNativePlatform:()=>x,unableToLoadToken:()=>O,unableToParseState:()=>l,unableToParseTokenRequestCacheError:()=>k,uninitializedPublicClientApplication:()=>$,userCancelled:()=>p});const o="pkce_not_created",n="crypto_nonexistent",i="empty_navigate_uri",a="hash_empty_error",s="no_state_in_hash",c="hash_does_not_contain_known_properties",l="unable_to_parse_state",h="state_interaction_type_mismatch",d="interaction_in_progress",u="popup_window_error",g="empty_window_error",p="user_cancelled",m="monitor_popup_timeout",C="monitor_window_timeout",v="redirect_in_iframe",f="block_iframe_reload",y="block_nested_popups",w="iframe_closed_prematurely",I="silent_logout_unsupported",T="no_account_error",A="silent_prompt_value_error",b="no_token_request_cache_error",k="unable_to_parse_token_request_cache_error",E="no_cached_authority_error",S="auth_request_not_set_error",R="invalid_cache_type",P="non_browser_environment",N="database_not_open",M="no_network_connectivity",_="post_request_failed",q="get_request_failed",B="failed_to_parse_response",O="unable_to_load_token",U="crypto_key_not_found",H="auth_code_required",L="auth_code_or_nativeAccountId_required",D="spa_code_and_nativeAccountId_present",K="database_unavailable",x="unable_to_acquire_token_from_native_platform",z="native_handshake_timeout",F="native_extension_not_installed",X="native_connection_not_established",$="uninitialized_public_client_application",G="native_prompt_not_supported",W="invalid_base64_string",Q="invalid_pop_token_request"},48405:(e,t,r)=>{r.d(t,{XX:()=>s,cl:()=>a,jz:()=>c});var o=r(32041),n=r(47381);const i={[n.storageNotSupported]:"Given storage configuration option was not supported.",[n.stubbedPublicClientApplicationCalled]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[n.inMemRedirectUnavailable]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},a={storageNotSupportedError:{code:n.storageNotSupported,desc:i[n.storageNotSupported]},stubPcaInstanceCalled:{code:n.stubbedPublicClientApplicationCalled,desc:i[n.stubbedPublicClientApplicationCalled]},inMemRedirectUnavailable:{code:n.inMemRedirectUnavailable,desc:i[n.inMemRedirectUnavailable]}};class s extends o.lR{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,s.prototype)}}function c(e){return new s(e,i[e])}},47381:(e,t,r)=>{r.r(t),r.d(t,{inMemRedirectUnavailable:()=>i,storageNotSupported:()=>o,stubbedPublicClientApplicationCalled:()=>n});const o="storage_not_supported",n="stubbed_public_client_application_called",i="in_mem_redirect_unavailable"},63739:(e,t,r)=>{r.d(t,{J:()=>i});var o=r(78705),n=r(96121);class i{constructor(e){this.eventCallbacks=new Map,this.logger=e||new o.V({})}addEventCallback(e,t,r){if("undefined"!=typeof window){const o=r||(0,n.createGuid)();return this.eventCallbacks.has(o)?(this.logger.error(`Event callback with id: ${o} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(o,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${o}`),o)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,o){if("undefined"!=typeof window){const n={eventType:e,interactionType:t||null,payload:r||null,error:o||null,timestamp:Date.now()};this.eventCallbacks.forEach((([t,r],o)=>{(0===r.length||r.includes(e))&&(this.logger.verbose(`Emitting event to callback ${o}: ${e}`),t.apply(null,[n]))}))}}}},59806:(e,t,r)=>{r.d(t,{D:()=>i});var o=r(29701),n=r(51681);class i{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case o.B.LOGIN_START:return n.T$.Login;case o.B.SSO_SILENT_START:return n.T$.SsoSilent;case o.B.ACQUIRE_TOKEN_START:if(e.interactionType===n.X8.Redirect||e.interactionType===n.X8.Popup)return n.T$.AcquireToken;break;case o.B.HANDLE_REDIRECT_START:return n.T$.HandleRedirect;case o.B.LOGOUT_START:return n.T$.Logout;case o.B.SSO_SILENT_SUCCESS:case o.B.SSO_SILENT_FAILURE:if(t&&t!==n.T$.SsoSilent)break;return n.T$.None;case o.B.LOGOUT_END:if(t&&t!==n.T$.Logout)break;return n.T$.None;case o.B.HANDLE_REDIRECT_END:if(t&&t!==n.T$.HandleRedirect)break;return n.T$.None;case o.B.LOGIN_SUCCESS:case o.B.LOGIN_FAILURE:case o.B.ACQUIRE_TOKEN_SUCCESS:case o.B.ACQUIRE_TOKEN_FAILURE:case o.B.RESTORE_FROM_BFCACHE:if(e.interactionType===n.X8.Redirect||e.interactionType===n.X8.Popup){if(t&&t!==n.T$.Login&&t!==n.T$.AcquireToken)break;return n.T$.None}}return null}}},29701:(e,t,r)=>{r.d(t,{B:()=>o});const o={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"}},80943:(e,t,r)=>{r.r(t),r.d(t,{AccountEntity:()=>S.d,ApiId:()=>p.sA,AuthError:()=>R.lR,AuthErrorCodes:()=>P,AuthErrorMessage:()=>R.ej,AuthenticationHeaderParser:()=>N.H,AuthenticationScheme:()=>M.IO,AzureCloudInstance:()=>_._,BrowserAuthError:()=>m.jT,BrowserAuthErrorCodes:()=>W,BrowserAuthErrorMessage:()=>m.UP,BrowserCacheLocation:()=>p.Al,BrowserConfigurationAuthError:()=>C.XX,BrowserConfigurationAuthErrorCodes:()=>Q,BrowserConfigurationAuthErrorMessage:()=>C.cl,BrowserPerformanceClient:()=>k.S,BrowserPerformanceMeasurement:()=>E.BrowserPerformanceMeasurement,BrowserStorage:()=>w.s,BrowserUtils:()=>o,CacheLookupPolicy:()=>p.nN,ClientAuthError:()=>q.eB,ClientAuthErrorCodes:()=>B,ClientAuthErrorMessage:()=>q.NE,ClientConfigurationError:()=>O.q5,ClientConfigurationErrorCodes:()=>U,ClientConfigurationErrorMessage:()=>O.P7,DEFAULT_IFRAME_TIMEOUT_MS:()=>g.YH,EventHandler:()=>A.J,EventMessageUtils:()=>I.D,EventType:()=>T.B,InteractionRequiredAuthError:()=>H.CB,InteractionRequiredAuthErrorCodes:()=>L,InteractionRequiredAuthErrorMessage:()=>H.$D,InteractionStatus:()=>p.T$,InteractionType:()=>p.X8,JsonWebTokenTypes:()=>M.Lz,LogLevel:()=>D.$,Logger:()=>D.V,MemoryStorage:()=>y.X,NavigationClient:()=>f.c,OIDC_DEFAULT_SCOPES:()=>M.aZ,PerformanceEvents:()=>K.MX,PromptValue:()=>M._M,ProtocolMode:()=>x.e,PublicClientApplication:()=>n.vq,PublicClientNext:()=>u,ServerError:()=>z.g,ServerResponseType:()=>M.zL,SignedHttpRequest:()=>b.a,StringUtils:()=>F.$,StubPerformanceClient:()=>X.a,UrlString:()=>$.H,WrapperSKU:()=>p.f7,createNestablePublicClientApplication:()=>n.Ji,createStandardPublicClientApplication:()=>n.q8,stubbedPublicClientApplication:()=>v.K,version:()=>G.r});var o=r(96121),n=r(81136),i=r(12096),a=r(78822),s=r(25568),c=r(56165);class l{constructor(e){this.initialized=!1,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.logger=e.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new c.M(this.logger,this.performanceClient):a.j,this.browserStorage=this.isBrowserEnvironment?new s.c(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,void 0,this.performanceClient):(0,s.E)(this.config.auth.clientId,this.logger)}getBrowserStorage(){return this.browserStorage}getAccount(e){return null}getAccountByHomeId(e){return null}getAccountByLocalId(e){return null}getAccountByUsername(e){return null}getAllAccounts(){return[]}initialize(){return this.initialized=!0,Promise.resolve()}acquireTokenPopup(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}acquireTokenRedirect(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),Promise.resolve()}acquireTokenSilent(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}acquireTokenByCode(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}acquireTokenNative(e,t,r){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}acquireTokenByRefreshToken(e,t){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}addEventCallback(e,t){return null}removeEventCallback(e){}addPerformanceCallback(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),""}removePerformanceCallback(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),!0}enableAccountStorageEvents(){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}disableAccountStorageEvents(){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}handleRedirectPromise(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),Promise.resolve(null)}loginPopup(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}loginRedirect(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}logout(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}logoutRedirect(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}logoutPopup(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}ssoSilent(e){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}getTokenCache(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}getLogger(){return this.logger}setLogger(e){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}setActiveAccount(e){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}getActiveAccount(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),null}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}getConfiguration(){return this.config}isBrowserEnv(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),!0}getBrowserCrypto(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}getPerformanceClient(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}getRedirectResponse(){return(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)(),{}}async clearCache(e){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}async hydrateCache(e,t){(0,o.blockAPICallsBeforeInitialize)(this.initialized),(0,o.blockNonBrowserEnvironment)()}}var h=r(57720);class d extends h.A{getId(){return d.ID}getModuleName(){return d.MODULE_NAME}async initialize(){return!0}}d.MODULE_NAME="",d.ID="UnknownOperatingContext";class u{static async createPublicClientApplication(e){const t=await(0,i.d)(e);let r;return r=null!==t?new u(e,t):new u(e),r}constructor(e,t){if(this.configuration=e,t)this.controller=t;else{const t=new d(e);this.controller=new l(t)}}async initialize(){if(this.controller instanceof l){const e=await(0,i.d)(this.configuration);return null!==e&&(this.controller=e),this.controller.initialize()}return Promise.resolve()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}var g=r(8297),p=r(51681),m=r(46093),C=r(48405),v=r(6223),f=r(8466),y=r(83359),w=r(37738),I=r(59806),T=r(29701),A=r(63739),b=r(58501),k=r(49651),E=r(14690),S=r(99611),R=r(32041),P=r(56297),N=r(24042),M=r(18087),_=r(92731),q=r(44774),B=r(28952),O=r(60826),U=r(94348),H=r(48686),L=r(7936),D=r(78705),K=r(65925),x=r(5917),z=r(59744),F=r(36106),X=r(89266),$=r(81e3),G=r(36979),W=r(70413),Q=r(47381)},5305:(e,t,r)=>{r.d(t,{H:()=>o});const o={UserInteractionRequired:"USER_INTERACTION_REQUIRED",UserCancel:"USER_CANCEL",NoNetwork:"NO_NETWORK",TransientError:"TRANSIENT_ERROR",PersistentError:"PERSISTENT_ERROR",Disabled:"DISABLED",AccountUnavailable:"ACCOUNT_UNAVAILABLE",NestedAppAuthUnavailable:"NESTED_APP_AUTH_UNAVAILABLE"}},8466:(e,t,r)=>{r.d(t,{c:()=>o});class o{navigateInternal(e,t){return o.defaultNavigateWindow(e,t)}navigateExternal(e,t){return o.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e=>{setTimeout((()=>{e(!0)}),t.timeout)}))}}},57720:(e,t,r)=>{r.d(t,{A:()=>s});var o=r(78705),n=r(8297),i=r(36979),a=r(51681);class s{static loggerCallback(e,t){switch(e){case o.$.Error:return void console.error(t);case o.$.Info:return void console.info(t);case o.$.Verbose:return void console.debug(t);case o.$.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=(0,n.tD)(e,this.browserEnvironment);try{t=window[a.Al.SessionStorage]}catch(e){}const r=t?.getItem(a.L$),c=t?.getItem(a.P3)?.toLowerCase(),l="true"===c||"false"!==c&&void 0,h={...this.config.system.loggerOptions},d=r&&Object.keys(o.$).includes(r)?o.$[r]:void 0;d&&(h.loggerCallback=s.loggerCallback,h.logLevel=d),void 0!==l&&(h.piiLoggingEnabled=l),this.logger=new o.V(h,i.U,i.r),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}},92775:(e,t,r)=>{r.d(t,{R:()=>l});var o=r(57720),n=r(5305),i=r(55509),a=r(51681),s=r(36979);class c{static async initializeNestedAppAuthBridge(){if(void 0===window)throw new Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",(e=>{const t="string"==typeof e?e:e.data,r=JSON.parse(t),o=c.bridgeRequests.find((e=>e.requestId===r.requestId));void 0!==o&&(c.bridgeRequests.splice(c.bridgeRequests.indexOf(o),1),r.success?o.resolve(r):o.reject(r.error))}));const e=await new Promise(((e,t)=>{const r=c.buildRequest("GetInitContext"),o={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(o),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}));return c.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){const r=await this.sendRequest(e,{tokenParams:t});return{token:c.validateBridgeResultOrThrow(r.token),account:c.validateBridgeResultOrThrow(r.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:(0,i.Oy)(),sendTime:Date.now(),clientLibrary:a.Q1.MSAL_SKU,clientLibraryVersion:s.r,...t}}sendRequest(e,t){const r=c.buildRequest(e,t);return new Promise(((e,t)=>{const o={requestId:r.requestId,method:r.method,resolve:e,reject:t};c.bridgeRequests.push(o),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}))}static validateBridgeResultOrThrow(e){if(void 0===e)throw{status:n.H.NestedAppAuthUnavailable};return e}constructor(e,t,r,o){this.sdkName=e,this.sdkVersion=t,this.accountContext=r,this.capabilities=o}static async create(){const e=await c.initializeNestedAppAuthBridge();return new c(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}c.bridgeRequests=[];class l extends o.A{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return l.MODULE_NAME}getId(){return l.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();const e=await c.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(e){this.logger.infoPii(`Could not initialize Nested App Auth bridge (${e})`)}return this.logger.info(`Nested App Auth Bridge available: ${this.available}`),this.available}}l.MODULE_NAME="",l.ID="NestedAppOperatingContext"},22224:(e,t,r)=>{r.d(t,{A:()=>n});var o=r(57720);class n extends o.A{getModuleName(){return n.MODULE_NAME}getId(){return n.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}n.MODULE_NAME="",n.ID="StandardOperatingContext"},36979:(e,t,r)=>{r.d(t,{U:()=>o,r:()=>n});const o="@azure/msal-browser",n="3.26.1"},49651:(e,t,r)=>{r.d(t,{S:()=>u});var o=r(72538),n=r(18087),i=r(78705),a=r(36979),s=r(51681),c=r(55509);function l(){let e;try{e=window[s.Al.SessionStorage];const t=e?.getItem(s.Fi);if(1===Number(t))return r.e(64392).then(r.bind(r,14690))}catch(e){}}function h(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now}function d(e){if(e&&h())return Math.round(window.performance.now()-e)}class u extends o.cm{constructor(e,t,r){super(e.auth.clientId,e.auth.authority||`${n.YM.DEFAULT_AUTHORITY}`,new i.V(e.system?.loggerOptions||{},a.U,a.r),a.U,a.r,e.telemetry?.application||{appName:"",appVersion:""},t,r)}generateId(){return(0,c.Oy)()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){l()?.then((t=>{const r=this.eventsByCorrelationId.get(e.event.correlationId),o=r&&r.eventId===e.event.eventId,n=[];o&&r?.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach((e=>{n.push({...e})})),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,n)}))}startMeasurement(e,t){const r=this.getPageVisibility(),o=super.startMeasurement(e,t),n=h()?window.performance.now():void 0,i=l()?.then((t=>new t.BrowserPerformanceMeasurement(e,o.event.correlationId)));return i?.then((e=>e.startMeasurement())),{...o,end:(e,t)=>{const a=o.end({...e,startPageVisibility:r,endPageVisibility:this.getPageVisibility(),durationMs:d(n)},t);return i?.then((e=>e.endMeasurement())),this.deleteIncompleteSubMeasurements(o),a},discard:()=>{o.discard(),i?.then((e=>e.flushMeasurement())),this.deleteIncompleteSubMeasurements(o)}}}setPreQueueTime(e,t){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);const r=this.preQueueTimeByCorrelationId.get(t);r&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${r.name} found`,t),this.addQueueMeasurement(r.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,r,o){if(!h())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);const n=super.getPreQueueTime(e,t);if(!n)return;const i=window.performance.now(),a=r||super.calculateQueuedTime(n,i);return super.addQueueMeasurement(e,t,a,o)}}},14690:(e,t,r)=>{r.r(t),r.d(t,{BrowserPerformanceMeasurement:()=>o});class o{constructor(e,t){this.correlationId=t,this.measureName=o.makeMeasureName(e,t),this.startMark=o.makeStartMark(e,t),this.endMark=o.makeEndMark(e,t)}static makeMeasureName(e,t){return`msal.measure.${e}.${t}`}static makeStartMark(e,t){return`msal.start.${e}.${t}`}static makeEndMark(e,t){return`msal.end.${e}.${t}`}static supportsBrowserPerformance(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.mark&&"function"==typeof window.performance.measure&&"function"==typeof window.performance.clearMarks&&"function"==typeof window.performance.clearMeasures&&"function"==typeof window.performance.getEntriesByName}static flushMeasurements(e,t){if(o.supportsBrowserPerformance())try{t.forEach((t=>{const r=o.makeMeasureName(t.name,e);window.performance.getEntriesByName(r,"measure").length>0&&(window.performance.clearMeasures(r),window.performance.clearMarks(o.makeStartMark(r,e)),window.performance.clearMarks(o.makeEndMark(r,e)))}))}catch(e){}}startMeasurement(){if(o.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(e){}}endMeasurement(){if(o.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(e){}}flushMeasurement(){if(o.supportsBrowserPerformance())try{const e=window.performance.getEntriesByName(this.measureName,"measure");if(e.length>0){const t=e[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),t}}catch(e){}return null}}},51681:(e,t,r)=>{r.d(t,{$u:()=>f,Al:()=>s,CC:()=>c,Ct:()=>a,Fi:()=>k,G8:()=>y,H3:()=>d,JD:()=>i,JE:()=>T,L$:()=>A,P3:()=>b,Q1:()=>n,T$:()=>p,WJ:()=>w,X8:()=>g,_p:()=>l,dh:()=>h,f7:()=>v,jb:()=>C,nN:()=>I,sA:()=>u,uq:()=>m});var o=r(18087);const n={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},i={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},a={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},s={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},c={GET:"GET",POST:"POST"},l={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},h={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},d={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},u={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var g;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(g||(g={}));const p={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},m={scopes:o.aZ},C="jwk",v={React:"@azure/msal-react",Angular:"@azure/msal-angular"},f="msal.db",y=1,w=`${f}.keys`,I={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},T=[I.Default,I.Skip,I.RefreshTokenAndNetwork],A="msal.browser.log.level",b="msal.browser.log.pii",k="msal.browser.performance.enabled"},19973:(e,t,r)=>{r.d(t,{A:()=>a});var o=r(91755),n=r(44774),i=r(28952);function a(e,t){if(!t)return null;try{return o.W.parseRequestState(e,t).libraryState.meta}catch(e){throw(0,n.SB)(i.invalidState)}}},96121:(e,t,r)=>{r.r(t),r.d(t,{blockAPICallsBeforeInitialize:()=>I,blockAcquireTokenInPopups:()=>y,blockNonBrowserEnvironment:()=>w,blockRedirectInIframe:()=>f,blockReloadInHiddenIframes:()=>v,clearHash:()=>d,createGuid:()=>k,getCurrentUri:()=>m,getHomepage:()=>C,invoke:()=>n.l,invokeAsync:()=>n.T,isInIframe:()=>g,isInPopup:()=>p,preconnect:()=>b,preflightCheck:()=>T,redirectPreflightCheck:()=>A,replaceHash:()=>u});var o=r(81e3),n=r(69564),i=r(46093),a=r(51681),s=r(55509),c=r(48405),l=r(70413),h=r(47381);function d(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function u(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function g(){return window.parent!==window}function p(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${a.Q1.POPUP_NAME_PREFIX}.`)}function m(){return window.location.href.split("?")[0].split("#")[0]}function C(){const e=new o.H(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function v(){if(o.H.hashContainsKnownProperties(window.location.hash)&&g())throw(0,i.bD)(l.blockIframeReload)}function f(e){if(g()&&!e)throw(0,i.bD)(l.redirectInIframe)}function y(){if(p())throw(0,i.bD)(l.blockNestedPopups)}function w(){if("undefined"==typeof window)throw(0,i.bD)(l.nonBrowserEnvironment)}function I(e){if(!e)throw(0,i.bD)(l.uninitializedPublicClientApplication)}function T(e){w(),v(),y(),I(e)}function A(e,t){if(T(e),f(t.system.allowRedirectInIframe),t.cache.cacheLocation===a.Al.MemoryStorage&&!t.cache.storeAuthStateInCookie)throw(0,c.jz)(h.inMemRedirectUnavailable)}function b(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout((()=>{try{document.head.removeChild(t)}catch{}}),1e4)}function k(){return(0,s.Oy)()}}}]);
//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/app-home_v1_azurebrowser_087545a5460e26787ce8.bundle.js.map/a3e8711c0698527ae02b76a38929b0de/app-home_v1_azurebrowser_087545a5460e26787ce8.bundle.js.map